(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[529,974],{4905:(e,t,s)=>{Promise.resolve().then(s.bind(s,3424))},3424:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>P});var a=s(5155),l=s(2115);let r=e=>{let{children:t,className:s=""}=e;return(0,a.jsx)("div",{className:"rounded-lg border border-gray-700 bg-gray-800 ".concat(s),children:t})},n=e=>{let{children:t,className:s=""}=e;return(0,a.jsx)("div",{className:"p-6 pb-2 ".concat(s),children:t})},i=e=>{let{children:t,className:s=""}=e;return(0,a.jsx)("h3",{className:"text-lg font-semibold text-white ".concat(s),children:t})},o=e=>{let{children:t,className:s=""}=e;return(0,a.jsx)("div",{className:"p-6 ".concat(s),children:t})};var c=s(9584),d=s(849);let u=()=>{let{isAuthenticated:e,address:t,isCurrentAccount:s}=(0,c.Hr)(),{password:u}=(0,l.useContext)(c.cy),[m,x]=(0,l.useState)(null),[h,p]=(0,l.useState)(!0),[g,f]=(0,l.useState)(null),[b,v]=(0,l.useState)([]),[j,y]=(0,l.useState)(!0),[w,N]=(0,l.useState)(null),[k,S]=(0,l.useState)(new Set),[C,E]=(0,l.useState)(null),[_,A]=(0,l.useState)(!0),[P,I]=(0,l.useState)(!1),[T,R]=(0,l.useState)(null),[D,M]=(0,l.useState)(!1),[F,q]=(0,l.useState)(0),O=l.useMemo(()=>m?[{label:"XRP Balance",value:"number"==typeof m.xrp_balance?m.xrp_balance.toFixed(6):m.xrp_balance},{label:"PFT Balance",value:"number"==typeof m.pft_balance?m.pft_balance.toFixed(2):m.pft_balance}]:[{label:"XRP Balance",value:"0"},{label:"PFT Balance",value:"0"}],[m]),L=async(e,s)=>{try{return(await d.apiService.post("/decrypt/doc_link",{account:t,password:s,encrypted_link:e})).link}catch(e){throw console.error("Error decrypting link:",e),e}},z=async e=>{if(e.includes("WHISPER__")){let t=e.substring(e.indexOf("WHISPER__"));I(!0),R({type:"decrypt_link",data:{link:t}})}else window.open(e,"_blank")},W=async e=>{if((null==T?void 0:T.type)==="decrypt_link")try{M(!0);let t=await L(T.data.link,e);window.open(t,"_blank")}catch(e){f("Failed to decrypt link: ".concat(e instanceof Error?e.message:String(e)))}finally{M(!1),I(!1),R(null)}};(0,l.useEffect)(()=>{let a=async()=>{if(!t||!e||!s(t)){console.log("Not fetching summary - inactive account or not authenticated"),p(!1);return}try{p(!0);let e=await d.apiService.get("/account/".concat(t,"/summary"));console.log("Received summary data:",e),x(e)}catch(e){console.error("Error fetching summary:",e),f(e instanceof Error?e.message:"Failed to fetch account summary")}finally{p(!1)}};t&&e&&s(t)?a():p(!1)},[t,e]),(0,l.useEffect)(()=>{let a=async()=>{if(!t||!e||!s(t)){console.log("Not starting refresh loop - inactive account or not authenticated"),y(!1);return}console.log("Starting task refresh for account: ".concat(t));let a=async()=>{if(!s(t)){console.log("Skipping task refresh for inactive account: ".concat(t));return}try{y(!0);let e=F?"/tasks/".concat(t,"?since=").concat(F):"/tasks/".concat(t),s=await d.apiService.get(e);if(q(Math.floor(Date.now()/1e3)),0===F){let e=[...s.requested||[],...s.proposed||[],...s.accepted||[],...s.challenged||[],...s.completed||[],...s.refused||[]],t=e=>{let t=e.split("__")[0].replace("_","T")+":00";return new Date(t).getTime()};e.sort((e,s)=>t(s.id)-t(e.id)),v(e.slice(0,10))}else v(e=>{let t=new Map(e.map(e=>[e.id,e]));["requested","proposed","accepted","challenged","completed","refused"].forEach(e=>{s[e]&&s[e].forEach(e=>{t.set(e.id,e)})}),s.removed_task_ids&&s.removed_task_ids.forEach(e=>{t.delete(e)});let a=Array.from(t.values()),l=e=>{let t=e.split("__")[0].replace("_","T")+":00";return new Date(t).getTime()};return a.sort((e,t)=>l(t.id)-l(e.id)),a.slice(0,10)});N(null)}catch(e){console.error("Error fetching tasks:",e),N(e instanceof Error?e.message:"Failed to fetch tasks")}finally{y(!1)}};await a();let l=setInterval(()=>{s(t)?a():(console.log("Stopping interval for inactive account: ".concat(t)),clearInterval(l))},3e4);return()=>{console.log("Cleaning up task refresh interval for: ".concat(t)),clearInterval(l)}};t&&e&&s(t)?a():y(!1)},[t,e]),(0,l.useEffect)(()=>{let a=async()=>{if(!t||!e||!s(t)){console.log("Not fetching account status - inactive account or not authenticated"),A(!1);return}try{A(!0);let e=await d.apiService.get("/account/".concat(t,"/status?refresh=true"));console.log("Received account status data:",JSON.stringify(e,null,2)),E(e)}catch(e){console.error("Status fetch error:",e)}finally{A(!1)}};t&&e&&s(t)?a():A(!1)},[t,e]);let V=[{label:"Account Address",value:t||"",copyable:!0},{label:"Task Node",value:"r4yc85M1hwsegVGZ1pawpZPwj65SVs8PzD",copyable:!0}],B=_?[]:[...(null==C?void 0:C.init_rite_statement)?[{label:"Initiation Rite",value:'"'.concat(C.init_rite_statement,'"'),className:"italic text-white"}]:[],{label:"Initiation Status",value:(null==C?void 0:C.init_rite_status)||"Unknown",className:(null==C?void 0:C.init_rite_status)==="COMPLETED"?"text-green-400":(null==C?void 0:C.init_rite_status)==="PENDING"?"text-yellow-400":"text-slate-200"},{label:"Blacklist Status",value:(null==C?void 0:C.is_blacklisted)?"BLACKLISTED":"NOT BLACKLISTED",className:(null==C?void 0:C.is_blacklisted)?"text-red-400":"text-green-400"},...(null==C?void 0:C.sweep_address)?[{label:"Sweep Address",value:C.sweep_address,copyable:!0}]:[],...(null==C?void 0:C.context_doc_link)?[{label:"Context Document",value:"View Document",link:C.context_doc_link}]:[]].filter(e=>e),U=async e=>{try{await navigator.clipboard.writeText(e),console.log("Copied to clipboard: ".concat(e))}catch(e){console.error("Failed to copy:",e)}},H=e=>{S(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("style",{children:"\n    @keyframes fade-in {\n      from { opacity: 0; }\n      to { opacity: 1; }\n    }\n    \n    .animate-fade-in {\n      animation: fade-in 0.5s ease-out;\n    }\n  "}),(0,a.jsxs)("div",{className:"space-y-6",children:[h?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-6",children:[1,2].map(e=>(0,a.jsx)("div",{className:"bg-slate-900 border-slate-800 rounded-lg p-6 animate-pulse",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"h-4 w-24 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-8 w-32 bg-slate-700 rounded"})]})},e))}):g?(0,a.jsxs)("div",{className:"text-red-500",children:["Failed to load balance: ",g]}):(0,a.jsx)("div",{className:"grid grid-cols-2 gap-6 animate-fade-in",children:O.map(e=>(0,a.jsx)(r,{className:"bg-slate-900 border-slate-800",children:(0,a.jsx)(o,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-400",children:e.label}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-white mt-1",children:e.value})]})})},e.label))}),_?(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Account Details"})}),(0,a.jsx)(o,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[[1,2].map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-slate-800/50 animate-pulse",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-24 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-4 w-48 bg-slate-700 rounded"})]}),(0,a.jsx)("div",{className:"h-8 w-8 bg-slate-700 rounded"})]},e)),(0,a.jsxs)("div",{className:"border-t border-slate-800 pt-4 mt-4",children:[(0,a.jsx)("div",{className:"h-4 w-32 bg-slate-700 rounded mb-4 animate-pulse"}),[1,2,3,4].map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-slate-800/50 mb-4 animate-pulse",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-32 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-4 w-48 bg-slate-700 rounded"})]}),(0,a.jsx)("div",{className:"h-8 w-8 bg-slate-700 rounded"})]},e))]})]})})]}):(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800 animate-fade-in",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Account Details"})}),(0,a.jsx)(o,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[V.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-slate-800/50",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-400",children:e.label}),(0,a.jsx)("p",{className:"text-sm font-mono text-slate-200 mt-1",children:e.value})]}),e.copyable&&(0,a.jsx)("button",{onClick:()=>U(e.value),className:"p-2 rounded-md hover:bg-slate-700 text-slate-400 hover:text-white transition-colors",title:"Copy to clipboard",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})})})]},e.label)),B.length>0&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"border-t border-slate-800 pt-4 mt-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-400 mb-4",children:"Post Fiat Status"}),B.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-slate-800/50 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-400",children:e.label}),e.link?(0,a.jsx)("button",{onClick:()=>z(e.link),className:"text-blue-400 hover:underline hover:text-blue-300 text-sm mt-1",children:e.value}):(0,a.jsx)("p",{className:"text-sm mt-1 ".concat(e.className||"text-slate-200"),children:e.value})]}),e.copyable&&(0,a.jsx)("button",{onClick:()=>U(e.value),className:"p-2 rounded-md hover:bg-slate-700 text-slate-400 hover:text-white transition-colors",title:"Copy to clipboard",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})})})]},t))]})})]})})]}),j?(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Recent Activity"})}),(0,a.jsx)(o,{children:(0,a.jsx)("div",{className:"space-y-4",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"p-4 rounded-lg bg-slate-800/50 animate-pulse",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"h-4 w-32 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-4 w-20 bg-slate-700 rounded"})]}),(0,a.jsx)("div",{className:"h-4 w-3/4 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-4 w-24 bg-slate-700 rounded"})]})},e))})})]}):(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800 animate-fade-in",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Recent Activity"})}),(0,a.jsx)(o,{className:"max-h-[400px] overflow-y-auto",children:w?(0,a.jsxs)("div",{className:"text-red-500",children:["Error: ",w]}):0===b.length?(0,a.jsx)("div",{className:"text-slate-500",children:"No recent activity"}):(0,a.jsx)("div",{className:"space-y-4",children:b.map(e=>{let t=e.id.split("__")[0].replace("_"," ");return(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-slate-800/50 hover:bg-slate-800 transition-colors",children:[(0,a.jsxs)("div",{className:"cursor-pointer",onClick:()=>H(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-slate-400",children:e.message_history&&e.message_history.length>0?e.message_history[0].direction.charAt(0).toUpperCase()+e.message_history[0].direction.slice(1):"Unknown"}),(0,a.jsx)("span",{className:"text-xs font-mono text-slate-500",children:e.id})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700 text-slate-300",children:e.status}),(0,a.jsx)("svg",{className:"w-4 h-4 text-slate-400 transition-transform ".concat(k.has(e.id)?"transform rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]})]}),(0,a.jsx)("p",{className:"text-sm text-slate-300 mb-2",children:e.message_history&&e.message_history.length>0?e.message_history[0].data:"No message available"}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:t})]}),k.has(e.id)&&e.message_history&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-slate-400 mb-2",children:"Message History"}),(0,a.jsx)("div",{className:"space-y-3",children:Array.from(new Map(e.message_history.map(e=>["".concat(e.direction,":").concat(e.data),e])).values()).map((e,t)=>(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"text-slate-400 font-medium",children:[e.direction.charAt(0).toUpperCase()+e.direction.slice(1),":"]}),(0,a.jsx)("p",{className:"text-slate-300 mt-1 pl-4",children:e.data})]},t))})]})]},e.id)})})})]})]}),P&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Enter Password"}),(0,a.jsx)("p",{className:"text-slate-400 mb-4",children:"Your password is needed to decrypt the document link."}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),W(e.currentTarget.elements.namedItem("password").value)},children:[(0,a.jsx)("input",{type:"password",name:"password",className:"w-full p-3 bg-slate-800 border border-slate-700 rounded-md text-white mb-4",placeholder:"Your wallet password",required:!0}),g&&(0,a.jsx)("div",{className:"text-red-400 mb-4",children:g}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{I(!1),R(null)},className:"px-4 py-2 bg-slate-800 text-white rounded-md hover:bg-slate-700",disabled:D,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",disabled:D,children:D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Confirm"})]})]})]})})]})};function m(e){let{isOpen:t,onClose:s,onConfirm:r,error:n}=e,[i,o]=(0,l.useState)(""),[c,d]=(0,l.useState)(!1);if(!t)return null;let u=async e=>{e.preventDefault(),d(!0);try{await r(i),o("")}finally{d(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-md",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Confirm Password"}),(0,a.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-300",children:"Enter your password to sign this transaction"}),(0,a.jsx)("input",{type:"password",value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Password",required:!0})]}),n&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:n}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Confirming...":"Confirm"})]})]})]})})})}let x=e=>{let{isOpen:t,onClose:s,taskId:r,onAccept:n,initialMessage:i}=e,[o,u]=(0,l.useState)(i),[x,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(""),[f,b]=(0,l.useState)(!1),{address:v,username:j,password:y,setPassword:w}=(0,l.useContext)(c.cy);if((0,l.useEffect)(()=>{u(i)},[i]),!t)return null;let N=async e=>{if(e.preventDefault(),!y){b(!0);return}await k(y)},k=async e=>{g(""),h(!0);try{let t={account:v,tx_type:"task_acceptance",password:e,data:{message:o,task_id:r,username:j}};console.log("Sending request data:",{...t,password:"[REDACTED]"});let a=await d.apiService.post("/transaction/send",t);console.log("Success response:",a),n(r,o),u(""),s()}catch(e){console.error("Error accepting task:",e),g(e instanceof Error?e.message:"Failed to accept task")}finally{h(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Accept Task"}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Task ID"}),(0,a.jsx)("input",{type:"text",value:r,disabled:!0,className:"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Acceptance Message"}),(0,a.jsx)("textarea",{value:o,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[100px]",placeholder:"Enter your acceptance message...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(o.length>=950?"text-amber-400":"text-slate-500"),children:[o.length,"/1000"]})})]}),p&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:p}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Sending...":"Accept Task"})]})]})]})})}),(0,a.jsx)(m,{isOpen:f,onClose:()=>b(!1),onConfirm:async e=>{b(!1),w(e),await k(e)},error:p})]})};function h(e){let{isOpen:t,onClose:s,onRequest:r,initialMessage:n}=e,[i,o]=(0,l.useState)(n),[u,x]=(0,l.useState)(!1),[h,p]=(0,l.useState)(""),[g,f]=(0,l.useState)(!1),{address:b,username:v,password:j,setPassword:y}=(0,l.useContext)(c.cy);if((0,l.useEffect)(()=>{o(n)},[n]),!t)return null;let w=async e=>{if(e.preventDefault(),!j){f(!0);return}await N(j)},N=async e=>{p(""),x(!0);try{let t=function(){let e=new Date,t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",s="0123456789",a=Array.from({length:2},()=>t[Math.floor(Math.random()*t.length)]).join(""),l=Array.from({length:2},()=>s[Math.floor(Math.random()*s.length)]).join(""),r=e.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+),\s(\d+):(\d+)/,"$3-$1-$2_$4:$5");return"".concat(r,"__").concat(a).concat(l)}(),a={account:b,tx_type:"task_request",password:e,data:{request:i,task_id:t,username:v}};console.log("Sending request data:",{...a,password:"[REDACTED]"});let l=await d.apiService.post("/transaction/send",a);console.log("Success response:",l),r(i),o(""),s()}catch(e){console.error("Error sending task request:",e),p(e instanceof Error?e.message:"Failed to send request")}finally{x(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Request Task"}),(0,a.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-300",children:"Task Request Message"}),(0,a.jsx)("textarea",{value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Enter your task request...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(i.length>=950?"text-amber-400":"text-slate-500"),children:[i.length,"/1000"]})})]}),h&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:h}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Sending...":"Submit Request"})]})]})]})})}),(0,a.jsx)(m,{isOpen:g,onClose:()=>f(!1),onConfirm:async e=>{f(!1),y(e),await N(e)},error:h})]})}let p=e=>{let{isOpen:t,onClose:s,taskId:r,onRefuse:n,initialReason:i}=e,[o,u]=(0,l.useState)(i),[x,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(""),[f,b]=(0,l.useState)(!1),{address:v,username:j,password:y,setPassword:w}=(0,l.useContext)(c.cy);if((0,l.useEffect)(()=>{u(i)},[i]),!t)return null;let N=async e=>{if(e.preventDefault(),!y){b(!0);return}await k(y)},k=async e=>{g(""),h(!0);try{let t={account:v,tx_type:"task_refusal",password:e,data:{refusal_reason:o,task_id:r,username:j}};console.log("Sending request data:",{...t,password:"[REDACTED]"});let a=await d.apiService.post("/transaction/send",t);console.log("Success response:",a),n(r,o),u(""),s()}catch(e){console.error("Error refusing task:",e),g(e instanceof Error?e.message:"Failed to refuse task")}finally{h(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Refuse Task"}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Task ID"}),(0,a.jsx)("input",{type:"text",value:r,disabled:!0,className:"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Reason for Refusal"}),(0,a.jsx)("textarea",{value:o,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[100px]",placeholder:"Enter reason for refusing the task...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(o.length>=950?"text-amber-400":"text-slate-500"),children:[o.length,"/1000"]})})]}),p&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:p}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-red-600 hover:bg-red-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Sending...":"Refuse Task"})]})]})]})})}),(0,a.jsx)(m,{isOpen:f,onClose:()=>b(!1),onConfirm:async e=>{b(!1),w(e),await k(e)},error:p})]})},g=e=>{let{isOpen:t,onClose:s,taskId:r,onSubmit:n,initialDetails:i}=e,[o,u]=(0,l.useState)(i),[x,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(""),[f,b]=(0,l.useState)(!1),{address:v,username:j,password:y,setPassword:w}=(0,l.useContext)(c.cy);if((0,l.useEffect)(()=>{u(i)},[i]),!t)return null;let N=async e=>{if(e.preventDefault(),!y){b(!0);return}await k(y)},k=async e=>{g(""),h(!0);try{let t={account:v,tx_type:"task_completion",password:e,data:{completion_justification:o,task_id:r,username:j}};console.log("Sending request data:",{...t,password:"[REDACTED]"});let a=await d.apiService.post("/transaction/send",t);console.log("Success response:",a),n(r,o),u(""),s()}catch(e){console.error("Error submitting completion:",e),g(e instanceof Error?e.message:"Failed to submit completion")}finally{h(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Submit for Verification"}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Task ID"}),(0,a.jsx)("input",{type:"text",value:r,disabled:!0,className:"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Verification Details"}),(0,a.jsx)("textarea",{value:o,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[200px]",placeholder:"Enter verification details...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(o.length>=950?"text-amber-400":"text-slate-500"),children:[o.length,"/1000"]})})]}),p&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:p}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:x,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Sending...":"Submit Verification"})]})]})]})})}),(0,a.jsx)(m,{isOpen:f,onClose:()=>b(!1),onConfirm:async e=>{b(!1),w(e),await k(e)},error:p})]})},f=e=>{let{isOpen:t,onClose:s,taskId:r,onSubmit:n,initialDetails:i,verificationPrompt:o}=e,[u,x]=(0,l.useState)(i),[h,p]=(0,l.useState)(!1),[g,f]=(0,l.useState)(""),[b,v]=(0,l.useState)(!1),{address:j,username:y,password:w,setPassword:N}=(0,l.useContext)(c.cy);if((0,l.useEffect)(()=>{x(i)},[i]),!t)return null;let k=async e=>{if(e.preventDefault(),!w){v(!0);return}await S(w)},S=async e=>{f(""),p(!0);try{let t={account:j,tx_type:"verification_response",password:e,data:{verification_response:u,task_id:r,username:y}};console.log("Sending request data:",{...t,password:"[REDACTED]"});let a=await d.apiService.post("/transaction/send",t);console.log("Success response:",a),n(r,u),x(""),s()}catch(e){console.error("Error submitting verification response:",e),f(e instanceof Error?e.message:"Failed to submit verification response")}finally{p(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Submit Verification Response"}),(0,a.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Task ID"}),(0,a.jsx)("input",{type:"text",value:r,disabled:!0,className:"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500"})]}),o&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Verification Prompt"}),(0,a.jsx)("div",{className:"w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-lg  text-slate-300 text-sm max-h-[150px] overflow-y-auto",children:o})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Verification Response"}),(0,a.jsx)("textarea",{value:u,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[200px]",placeholder:"Enter your verification response...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(u.length>=950?"text-amber-400":"text-slate-500"),children:[u.length,"/1000"]})})]}),g&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:g}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Sending...":"Submit Response"})]})]})]})})}),(0,a.jsx)(m,{isOpen:b,onClose:()=>v(!1),onConfirm:async e=>{v(!1),N(e),await S(e)},error:g})]})},b=e=>{let{isOpen:t,onClose:s,onSubmit:r,initialDetails:n}=e,[i,o]=(0,l.useState)(n),[u,x]=(0,l.useState)(!1),[h,p]=(0,l.useState)(""),[g,f]=(0,l.useState)(!1),{address:b,username:v,password:j}=(0,l.useContext)(c.cy);if((0,l.useEffect)(()=>{o(n)},[n]),!t)return null;let y=async e=>{if(e.preventDefault(),!j){f(!0);return}await w(j)},w=async e=>{p(""),x(!0);try{let t="pomo_".concat(Date.now()),a={account:b,password:e,log_message:i,log_id:t,username:v,use_pft:!0};console.log("Sending PF Log request:",{...a,password:"[REDACTED]"});let l=await d.apiService.post("/transaction/pf_log",a);console.log("PF Log success response:",l),r(i),s()}catch(e){console.error("Error submitting PF log:",e),p(e instanceof Error?e.message:"Failed to submit PF log")}finally{x(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Submit Pomodoro Log"}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Log Message"}),(0,a.jsx)("textarea",{value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[200px]",placeholder:"Enter your log message...",required:!0})]}),h&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:h}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Sending...":"Submit Log"})]})]})]})})}),(0,a.jsx)(m,{isOpen:g,onClose:()=>f(!1),onConfirm:async e=>{f(!1),await w(e)},error:h})]})},v=()=>{let{isAuthenticated:e,address:t,isCurrentAccount:s}=(0,c.Hr)(),{password:u}=(0,l.useContext)(c.cy),[m,v]=(0,l.useState)([]),[j,y]=(0,l.useState)(!0),[w,N]=(0,l.useState)(null),[k,S]=(0,l.useState)(!1),[C,E]=(0,l.useState)(new Set),[_,A]=(0,l.useState)(new Set),[P,I]=(0,l.useState)(""),[T,R]=(0,l.useState)({accept:!1,request:!1,refuse:!1,verify:!1,finalVerify:!1,logPomodoro:!1,verificationPrompt:""}),[D,M]=(0,l.useState)(null),[F,q]=(0,l.useState)(!1),[O,L]=(0,l.useState)("all"),[z,W]=(0,l.useState)(0),[V,B]=(0,l.useState)([]);(0,l.useEffect)(()=>{console.log("Address changed in ProposalsPage, resetting state:",t),v([]),N(null),W(0),E(new Set),L("all"),S(!1),t&&(y(!0),U(!0))},[t]);let U=async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!t||!e||!s(t)){console.log("Not fetching tasks - inactive account or not authenticated"),y(!1);return}q(!0),N(null);try{await new Promise(e=>setTimeout(e,1e3));let e="/tasks/".concat(t);console.log("Fetching tasks from: ".concat(e).concat(a?"":" (no cache)"));try{let t=await d.apiService.get(e,a);if(console.log("Received tasks data type:",typeof t),console.log("Keys in response:",Object.keys(t||{})),Array.isArray(t)){let e=t.filter(e=>{let t=V.find(t=>t.id===e.id);return!t||t.status!==e.status});v(e),console.log("Loaded ".concat(e.length," tasks out of ").concat(t.length," (filtered dismissed tasks)"))}else if(t&&"object"==typeof t){console.log("Received sections: ".concat(Object.keys(t).join(", ")));let e=[];["requested","proposed","accepted","challenged","refused"].forEach(s=>{t[s]&&Array.isArray(t[s])&&(e=[...e,...t[s]])});let s=e=>{if(!e||!e.includes("__"))return 0;let t=e.split("__")[0].replace("_","T")+":00";return new Date(t).getTime()};e.sort((e,t)=>s(t.id)-s(e.id)),k||(e=e.filter(e=>"refused"!==e.status));let a=e.filter(e=>{let t=V.find(t=>t.id===e.id);return!t||t.status!==e.status});v(a),console.log("Loaded ".concat(a.length," tasks out of ").concat(e.length," (filtered dismissed tasks)"))}else throw Error("Received invalid data format from API");W(Math.floor(Date.now()/1e3))}catch(e){throw console.error("API Error details:",e),e.response&&(console.error("Response data:",e.response.data),console.error("Response status:",e.response.status)),e}}catch(e){console.error("Error fetching tasks:",e),N(e instanceof Error?e.message:"Failed to fetch tasks")}finally{q(!1),y(!1)}};(0,l.useEffect)(()=>{let a=!1,l=null,r=async()=>{if(!t||!e||!s(t)){console.log("Not starting refresh loop - inactive account or not authenticated"),y(!1);return}console.log("Starting task refresh loop for account: ".concat(t));try{await d.apiService.post("/tasks/initialize/".concat(t)),console.log("Tasks initialized successfully"),await d.apiService.post("/tasks/start-refresh/".concat(t)),console.log("Task refresh loop started on server"),a=!0}catch(e){console.error("Failed to initialize tasks:",e),N("Failed to initialize tasks. Please try again."),y(!1);return}await U(!0),l=setInterval(()=>{s(t)?U():(console.log("Stopping interval for inactive account: ".concat(t)),l&&clearInterval(l))},6e4)};return t&&e&&s(t)?r():y(!1),()=>{l&&(console.log("Clearing refresh interval for: ".concat(t)),clearInterval(l)),t&&a&&(console.log("Stopping server refresh loop for: ".concat(t)),d.apiService.post("/tasks/stop-refresh/".concat(t)).then(()=>{console.log("Successfully stopped refresh loop for: ".concat(t))}).catch(e=>{console.error("Failed to stop refresh loop:",e)}))}},[t,e]),(0,l.useEffect)(()=>{U(!0)},[k]);let H=e=>{E(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},G=e=>{A(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},X=e=>{I(e)},Y=(e,t)=>{let s=t||P;if("request"!==e&&"logPomodoro"!==e&&(!s||!m.some(e=>e.id===s))){M("Please select a valid task first");return}M(null);let a="";if("verify"===e||"finalVerify"===e){let e=m.find(e=>e.id===s);if(null==e?void 0:e.message_history){let t=e.message_history.find(e=>e.data.includes("VERIFICATION PROMPT"));t?a=t.data:e.message_history.length>=5&&(a=e.message_history[4].data)}}R({...T,[e]:!0,verificationPrompt:a}),t&&I(t)},J=e=>{R({...T,[e]:!1}),M(null)},K=async(e,t)=>{try{let s=m.find(t=>t.id===e);if(!s)return;console.log("Accepting task:",e,t),J("accept"),B(t=>[...t,{id:e,status:s.status}]),v(t=>t.filter(t=>t.id!==e));let a=new Set(C);a.delete(e),E(a)}catch(e){console.error("Error accepting task:",e)}},$=async e=>{try{console.log("Requesting task:",e),J("request")}catch(e){console.error("Error requesting task:",e)}},Q=async(e,t)=>{try{let s=m.find(t=>t.id===e);if(!s)return;console.log("Refusing task:",e,t),J("refuse"),B(t=>[...t,{id:e,status:s.status}]),v(t=>t.filter(t=>t.id!==e));let a=new Set(C);a.delete(e),E(a)}catch(e){console.error("Error refusing task:",e)}},Z=async(e,t)=>{try{let s=m.find(t=>t.id===e);if(!s)return;console.log("Verification submitted:",e,t),J("verify"),B(t=>[...t,{id:e,status:s.status}]),v(t=>t.filter(t=>t.id!==e));let a=new Set(C);a.delete(e),E(a)}catch(e){console.error("Error handling verification submission:",e)}},ee=async(e,t)=>{try{let s=m.find(t=>t.id===e);if(!s)return;console.log("Final verification submitted:",e,t),J("finalVerify"),B(t=>[...t,{id:e,status:s.status}]),v(t=>t.filter(t=>t.id!==e));let a=new Set(C);a.delete(e),E(a)}catch(e){console.error("Error handling final verification:",e)}},et=async e=>{try{console.log("Pomodoro logged:",e),J("logPomodoro")}catch(e){console.error("Error logging pomodoro:",e)}},es=m.filter(e=>"all"===O||e.status===O),ea=e=>{var t;if(!(null===(t=e.message_history)||void 0===t?void 0:t.length))return"No message available";for(let t=0;t<e.message_history.length;t++){let s=e.message_history[t];if(s.data.startsWith("PROPOSED PF"))return s.data}return e.message_history.length>=2?e.message_history[1].data:e.message_history[0].data},el=(e,t)=>e.length<=300||_.has(t)?(0,a.jsx)("p",{className:"text-sm text-slate-300",children:e}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-slate-300",children:[e.substring(0,300),"..."]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),G(t)},className:"text-xs text-emerald-400 hover:text-emerald-300 mt-1",children:"Show more"})]}),er=e=>{switch(e.status){case"proposed":return(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),Y("accept",e.id)},className:"px-3 py-1 text-xs font-medium bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors",children:"Accept"}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),Y("refuse",e.id)},className:"px-3 py-1 text-xs font-medium bg-slate-700 hover:bg-slate-600  text-white rounded-lg transition-colors",children:"Refuse"})]});case"accepted":return(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),Y("verify",e.id)},className:"px-3 py-1 text-xs font-medium bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors",children:"Submit for Verification"}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),Y("refuse",e.id)},className:"px-3 py-1 text-xs font-medium bg-slate-700 hover:bg-slate-600  text-white rounded-lg transition-colors",children:"Refuse"})]});case"challenged":return(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),Y("finalVerify",e.id)},className:"px-3 py-1 text-xs font-medium bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors",children:"Submit Verification Details"}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),Y("refuse",e.id)},className:"px-3 py-1 text-xs font-medium bg-slate-700 hover:bg-slate-600  text-white rounded-lg transition-colors",children:"Refuse"})]});default:return null}};return((0,l.useEffect)(()=>{let e=setInterval(()=>{V.length>100&&B(e=>e.slice(-100))},36e5);return()=>clearInterval(e)},[V.length]),j)?(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:[1,2,3,4].map(e=>(0,a.jsx)("div",{className:"h-10 w-24 bg-slate-800 rounded-lg animate-pulse"},e))}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-10 w-28 bg-emerald-600/50 rounded-lg animate-pulse"}),(0,a.jsx)("div",{className:"h-10 w-24 bg-slate-800 rounded-lg animate-pulse"})]})]}),(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)("div",{className:"h-6 w-32 bg-slate-700 rounded animate-pulse"})}),(0,a.jsx)(o,{className:"max-h-[600px] overflow-y-auto space-y-4",children:[1,2,3,4].map(e=>(0,a.jsx)("div",{className:"p-4 rounded-lg bg-slate-800/50",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-4 w-48 bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-5 w-20 bg-blue-500/10 rounded-full animate-pulse"})]}),(0,a.jsx)("div",{className:"h-7 w-28 bg-slate-700 rounded-full animate-pulse"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-full bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-3/4 bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-1/2 bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-3 w-32 bg-slate-700 rounded animate-pulse mt-2"})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)("div",{className:"h-7 w-24 bg-emerald-600/50 rounded-lg animate-pulse"}),(0,a.jsx)("div",{className:"h-7 w-20 bg-slate-700 rounded-lg animate-pulse"})]})]})},e))})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("style",{children:"\n    @keyframes fade-in {\n      from { opacity: 0; }\n      to { opacity: 1; }\n    }\n    \n    .animate-fade-in {\n      animation: fade-in 0.5s ease-out;\n    }\n  "}),(0,a.jsxs)("div",{className:"space-y-6",children:[!e&&(0,a.jsx)("div",{className:"text-white",children:"Please sign in to view tasks."}),e&&!t&&(0,a.jsx)("div",{className:"text-white",children:"No wallet address found."}),w&&(0,a.jsxs)("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 p-4 rounded-lg",children:[(0,a.jsx)("p",{className:"font-medium",children:"Error:"}),(0,a.jsx)("p",{children:w})]}),e&&t&&!j&&(0,a.jsxs)(a.Fragment,{children:[D&&(0,a.jsx)("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4 mb-4",children:(0,a.jsx)("p",{className:"text-red-400 text-sm",children:D})}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:[(0,a.jsx)("button",{onClick:()=>L("all"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("all"===O?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"All Tasks"}),(0,a.jsx)("button",{onClick:()=>L("proposed"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("proposed"===O?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Proposed"}),(0,a.jsx)("button",{onClick:()=>L("accepted"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("accepted"===O?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Accepted"}),(0,a.jsx)("button",{onClick:()=>L("challenged"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("challenged"===O?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Verification"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:()=>Y("request"),className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium",children:"Request Task"}),(0,a.jsx)("button",{onClick:()=>U(),disabled:F,className:"px-4 py-2 bg-slate-800 hover:bg-slate-700  text-white rounded-lg transition-all duration-200 text-sm font-medium disabled:opacity-75 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:F?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{children:"Refreshing..."})]}):"Refresh"})]})]}),(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Active Tasks"})}),(0,a.jsx)(o,{className:"max-h-[600px] overflow-y-auto",children:0===es.length?(0,a.jsx)("div",{className:"text-slate-500",children:"No tasks available."}):(0,a.jsx)("div",{className:"space-y-4",children:es.map(e=>{let t=e.id.split("__")[0].replace("_"," "),s=ea(e);return(0,a.jsx)("div",{className:"p-4 rounded-lg bg-slate-800/50 hover:bg-slate-800 transition-colors cursor-pointer",onClick:()=>X(e.id),children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs font-mono text-slate-500",children:e.id}),(0,a.jsx)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("accepted"===e.status?"bg-emerald-500/10 text-emerald-400":"requested"===e.status?"bg-yellow-500/10 text-yellow-400":"proposed"===e.status?"bg-blue-500/10 text-blue-400":"challenged"===e.status?"bg-purple-500/10 text-purple-400":"bg-red-500/10 text-red-400"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]}),(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),H(e.id)},className:"px-3 py-1 text-xs font-medium text-slate-400 hover:text-white  bg-slate-700/50 hover:bg-slate-700 rounded-full transition-colors",children:C.has(e.id)?"Hide Messages":"Show Messages"})]}),(0,a.jsxs)("div",{children:[el(s,e.id),(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:t})]}),er(e),C.has(e.id)&&e.message_history&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-slate-400 mb-2",children:"Message History"}),(0,a.jsx)("div",{className:"space-y-3",children:Array.from(new Map(e.message_history.map(e=>["".concat(e.direction,":").concat(e.data),e])).values()).map((e,t)=>(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"text-slate-400 font-medium",children:[e.direction,":"]}),(0,a.jsx)("p",{className:"text-slate-300 mt-1 pl-4",children:e.data})]},t))})]})]})},e.id)})})})]}),(0,a.jsx)(x,{isOpen:T.accept,onClose:()=>J("accept"),taskId:P,onAccept:(e,t)=>{K(e,t)},initialMessage:""}),(0,a.jsx)(h,{isOpen:T.request,onClose:()=>J("request"),onRequest:e=>{$(e)},initialMessage:""}),(0,a.jsx)(p,{isOpen:T.refuse,onClose:()=>J("refuse"),taskId:P,onRefuse:(e,t)=>{Q(e,t)},initialReason:""}),(0,a.jsx)(g,{isOpen:T.verify,onClose:()=>J("verify"),taskId:P,onSubmit:(e,t)=>{Z(e,t)},initialDetails:""}),(0,a.jsx)(f,{isOpen:T.finalVerify,onClose:()=>J("finalVerify"),taskId:P,onSubmit:(e,t)=>{ee(e,t)},initialDetails:"",verificationPrompt:T.verificationPrompt}),(0,a.jsx)(b,{isOpen:T.logPomodoro,onClose:()=>J("logPomodoro"),onSubmit:et,initialDetails:""})]})]})]})},j=()=>{let{isAuthenticated:e,address:t,isCurrentAccount:s}=(0,c.Hr)(),[r,n]=(0,l.useState)([]),[i,o]=(0,l.useState)(!0),[u,m]=(0,l.useState)(null),[x,h]=(0,l.useState)("all"),[p,g]=(0,l.useState)(0),f=async function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!t||!e||!s(t)){console.log("Not fetching rewards - inactive account or not authenticated"),o(!1);return}try{let e="/tasks/".concat(t);!a&&p>0&&(e+="?since=".concat(p));let s=await d.apiService.get(e);if(g(Math.floor(Date.now()/1e3)),a||0===p){let e=[...s.rewarded||[],...s.refused||[]];e=e.map(e=>{var t;return(null===(t=s.rewarded)||void 0===t?void 0:t.some(t=>t.id===e.id))?{...e,status:"rewarded"}:{...e,status:"refused"}});let t=e=>{let t=e.split("__")[0].replace("_","T")+":00";return new Date(t).getTime()};e.sort((e,s)=>t(s.id)-t(e.id)),n(e)}else n(e=>{let t=new Map(e.map(e=>[e.id,e]));s.rewarded&&s.rewarded.forEach(e=>{t.set(e.id,{...e,status:"rewarded"})}),s.refused&&s.refused.forEach(e=>{t.set(e.id,{...e,status:"refused"})}),s.removed_task_ids&&s.removed_task_ids.forEach(e=>{t.delete(e)});let a=Array.from(t.values()),l=e=>{let t=e.split("__")[0].replace("_","T")+":00";return new Date(t).getTime()};return a.sort((e,t)=>l(t.id)-l(e.id)),a})}catch(e){m(e instanceof Error?e.message:"An error occurred")}finally{o(!1)}};(0,l.useEffect)(()=>{if(!t||!e||!s(t)){console.log("Not starting rewards fetch - inactive account or not authenticated"),o(!1);return}console.log("Fetching rewards for current account: ".concat(t)),f(!0);let a=setInterval(()=>{s(t)?f():(console.log("Stopping rewards interval for inactive account: ".concat(t)),clearInterval(a))},6e4);return()=>{console.log("Cleaning up rewards refresh interval for: ".concat(t)),clearInterval(a)}},[t,e]);let b=r.filter(e=>"all"===x||e.status===x),v=e=>{var t;if(!(null===(t=e.message_history)||void 0===t?void 0:t.length))return"No proposal available";for(let t=0;t<e.message_history.length;t++){let s=e.message_history[t];if(s.data.startsWith("PROPOSED PF"))return s.data}return e.message_history.length>=2?e.message_history[1].data:e.message_history[0].data},j="\n    @keyframes fade-in {\n      from { opacity: 0; }\n      to { opacity: 1; }\n    }\n    \n    .animate-fade-in {\n      animation: fade-in 0.5s ease-out;\n    }\n  ";return i?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4 space-y-6 animate-fade-in",children:[(0,a.jsx)("style",{children:j}),(0,a.jsx)("div",{className:"h-8 w-48 bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"flex space-x-4 mb-4",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"h-10 w-24 bg-slate-700 rounded-lg animate-pulse"},e))}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-gray-900 z-10",children:(0,a.jsx)("tr",{className:"border-b border-gray-700",children:["Task ID","Proposal","Reward/Refusal","Payout"].map((e,t)=>(0,a.jsx)("th",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-24 bg-slate-700 rounded animate-pulse"})},t))})}),(0,a.jsx)("tbody",{children:[1,2,3,4,5].map(e=>(0,a.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-48 bg-slate-700 rounded animate-pulse"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-full bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-3/4 bg-slate-700 rounded animate-pulse"})]})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-full bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-2/3 bg-slate-700 rounded animate-pulse"})]})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-20 bg-slate-700 rounded animate-pulse"})})]},e))})]})})})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4",children:[(0,a.jsx)("style",{children:j}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Finished Tasks"}),!e&&(0,a.jsx)("div",{className:"text-white",children:"Please sign in to view your finished tasks."}),e&&!t&&(0,a.jsx)("div",{className:"text-white",children:"No wallet address found."}),u&&(0,a.jsxs)("div",{className:"text-red-500",children:["Error: ",u]}),e&&t&&!i&&(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex space-x-4 mb-4",children:[(0,a.jsx)("button",{onClick:()=>h("all"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("all"===x?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"All Tasks"}),(0,a.jsx)("button",{onClick:()=>h("rewarded"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("rewarded"===x?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Rewarded"}),(0,a.jsx)("button",{onClick:()=>h("refused"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("refused"===x?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Refused"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-gray-900 z-10",children:(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Task ID"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Proposal"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Reward/Refusal"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Payout"})]})}),(0,a.jsx)("tbody",{children:0===b.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"p-4 text-gray-400 text-center",children:"No tasks available."})}):b.map(e=>{var t,s;let l=v(e),r="rewarded"===e.status&&(null===(t=e.message_history)||void 0===t?void 0:t.length)>1?e.message_history[e.message_history.length-1].data:null,n="refused"===e.status&&(null===(s=e.message_history)||void 0===s?void 0:s.length)>1?e.message_history[e.message_history.length-1].data:null,i="rewarded"===e.status&&r?r:"refused"===e.status&&n?n:"No response available";return(0,a.jsxs)("tr",{className:"border-b border-gray-800 hover:bg-gray-800/50",children:[(0,a.jsx)("td",{className:"p-4 text-gray-300 font-mono align-top whitespace-nowrap",children:e.id}),(0,a.jsx)("td",{className:"p-4 text-gray-300 align-top max-w-md",children:(0,a.jsx)("div",{className:"line-clamp-4",children:l})}),(0,a.jsx)("td",{className:"p-4 text-gray-300 align-top max-w-lg",children:(0,a.jsx)("div",{className:"line-clamp-4",children:i})}),(0,a.jsx)("td",{className:"p-4 text-gray-300 align-top whitespace-nowrap",children:"rewarded"===e.status?"".concat(e.pft_rewarded||e.pft_offered||"N/A"," PFT"):""})]},e.id)})})]})})})]})]})};function y(e){let{isOpen:t,onClose:s,onSubmit:r,initialAmount:n,initialToAddress:i,initialCurrency:o,initialMemoId:u,initialMemo:x}=e,{address:h,password:p,setPassword:g}=(0,l.useContext)(c.cy),[f,b]=(0,l.useState)(n),[v,j]=(0,l.useState)(i),[y,w]=(0,l.useState)(o),[N,k]=(0,l.useState)(u||""),[S,C]=(0,l.useState)(x||""),[E,_]=(0,l.useState)(!1),[A,P]=(0,l.useState)(""),[I,T]=(0,l.useState)(!1);if((0,l.useEffect)(()=>{b(n),j(i),w(o),k(u||""),C(x||"")},[n,i,o,u,x]),!t)return null;let R=async e=>{if(e.preventDefault(),!f||!v){P("Amount and destination address are required");return}p?await D(p):T(!0)},D=async e=>{P(""),_(!0);try{let t={from_account:h,to_address:v,amount:f,currency:y,password:e,memo_id:N||void 0,memo:S||void 0};console.log("Payment request:",{...t,password:"[REDACTED]"});let a=await d.apiService.post("/transaction/payment",t);console.log("Payment success response:",a),s()}catch(e){console.error("Error sending payment:",e),P(e instanceof Error?e.message:"Failed to send payment")}finally{_(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Send Payment"}),(0,a.jsxs)("form",{onSubmit:R,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:f,readOnly:!0,className:"flex-1 px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Amount",required:!0}),(0,a.jsxs)("select",{value:y,disabled:!0,className:"px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",children:[(0,a.jsx)("option",{value:"XRP",children:"XRP"}),(0,a.jsx)("option",{value:"PFT",children:"PFT"})]})]}),(0,a.jsx)("input",{type:"text",value:v,readOnly:!0,className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Destination Address",required:!0}),(0,a.jsx)("input",{type:"text",value:N,readOnly:!0,className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Memo ID (Optional)"}),(0,a.jsx)("input",{type:"text",value:S,readOnly:!0,className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Memo (Optional)"})]}),A&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:A}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:E,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:E?"Sending...":"Send Payment"})]})]})]})})}),(0,a.jsx)(m,{isOpen:I,onClose:()=>T(!1),onConfirm:async e=>{T(!1),g(e),await D(e)},error:A})]})}let w=()=>{let{isAuthenticated:e,address:t,isCurrentAccount:s}=(0,c.Hr)(),{password:r}=(0,l.useContext)(c.cy),[n,i]=(0,l.useState)("XRP"),[o,u]=(0,l.useState)([]),[m,x]=(0,l.useState)(!1),[h,p]=(0,l.useState)(""),[g,f]=(0,l.useState)(""),[b,v]=(0,l.useState)(""),[j,w]=(0,l.useState)(""),[N,k]=(0,l.useState)("idle"),[S,C]=(0,l.useState)(""),[E,_]=(0,l.useState)(!0),[A,P]=(0,l.useState)(0),I=async function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0],!t||!e||!s(t)){console.log("Not fetching payments - inactive account or not authenticated"),_(!1);return}_(!0);try{let e="/payments/".concat(t);console.log("Fetching payments from: ".concat(e));try{let t=await d.apiService.get(e);if(console.log("Received payments data type:",typeof t),console.log("Keys in response:",Object.keys(t||{})),t&&t.payments&&Array.isArray(t.payments)){let e=t.payments.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime());u(e),console.log("Loaded ".concat(e.length," payments"))}else console.warn("Received unexpected data format from payments API:",t),u([]);P(Math.floor(Date.now()/1e3))}catch(e){throw console.error("API Error details:",e),e.response&&(console.error("Response data:",e.response.data),console.error("Response status:",e.response.status)),e}}catch(e){console.error("Error fetching payments:",e),C(e instanceof Error?e.message:"Failed to fetch payments")}finally{_(!1)}};(0,l.useEffect)(()=>{if(!t||!e||!s(t)){console.log("Not starting payments fetch - inactive account or not authenticated"),_(!1);return}console.log("Starting payment fetch for current account: ".concat(t)),I(!0);let a=setInterval(()=>{s(t)?I(!1):(console.log("Stopping payment interval for inactive account: ".concat(t)),clearInterval(a))},3e4);return()=>{console.log("Cleaning up payment refresh interval for: ".concat(t)),clearInterval(a)}},[t,e]);let T=async(e,s,a,l,r)=>{k("loading"),C("");try{await d.apiService.post("/transaction/payment",{from_account:t,to_address:s,amount:e,currency:a,memo_id:l||void 0,memo:r||void 0}),p(""),f(""),v(""),w(""),k("success"),await I(!0)}catch(e){throw C(e.message),k("error"),e}};return(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-gray-900 text-gray-100",children:[(0,a.jsxs)("div",{className:"flex-none p-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Payments"}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!h||!g){C("Amount and destination address are required");return}x(!0)},className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"Send Amount",className:"w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:n,onChange:e=>i(e.target.value),className:"bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none pr-8",children:[(0,a.jsx)("option",{value:"XRP",children:"XRP"}),(0,a.jsx)("option",{value:"PFT",children:"PFT"})]}),(0,a.jsx)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),placeholder:"To Address",className:"w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("input",{type:"text",value:b,onChange:e=>v(e.target.value),placeholder:"Memo ID (optional)",className:"w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("input",{type:"text",value:j,onChange:e=>w(e.target.value),placeholder:"Memo (Optional)",className:"flex-1 bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 mr-2"}),(0,a.jsx)("button",{type:"submit",className:"bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-2 rounded-md transition-colors",children:"Send"})]})]})]}),S&&(0,a.jsx)("div",{className:"text-red-500 text-sm mt-2",children:S})]})]}),(0,a.jsx)("div",{className:"flex-1 min-h-0",children:(0,a.jsx)("div",{className:"h-full overflow-y-auto px-4",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-gray-900 z-10",children:(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"#"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Date"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Amount"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Token"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"To/From"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Address"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Tx Hash"})]})}),(0,a.jsx)("tbody",{children:E?[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)("tr",{className:"border-b border-gray-800 animate-pulse",children:[(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-8 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-24 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-16 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-12 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-8 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-32 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-40 bg-gray-700 rounded"})})]},"skeleton-".concat(t))):0===o.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"text-center p-8 text-gray-400",children:"No transactions found"})}):o.map((e,s)=>(0,a.jsxs)("tr",{className:"border-b border-gray-800 hover:bg-gray-800/50",children:[(0,a.jsx)("td",{className:"p-4 text-gray-300",children:s+1}),(0,a.jsx)("td",{className:"p-4 text-gray-300 whitespace-nowrap",children:e.timestamp}),(0,a.jsx)("td",{className:"p-4 text-gray-300",children:e.amount_xrp>0?e.amount_xrp:e.amount_pft}),(0,a.jsx)("td",{className:"p-4 text-gray-300",children:e.amount_xrp>0?"XRP":e.amount_pft>0?"PFT":""}),(0,a.jsx)("td",{className:"p-4 text-gray-300",children:e.from_address===t?"To":"From"}),(0,a.jsx)("td",{className:"p-4 text-gray-300 font-mono",children:e.from_address===t?e.to_address:e.from_address}),(0,a.jsx)("td",{className:"p-4 text-gray-300 font-mono",children:(0,a.jsxs)("a",{href:"https://livenet.xrpl.org/transactions/".concat(e.hash),target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 hover:underline",children:[e.hash.substring(0,10),"..."]})})]},s))})]})})}),(0,a.jsx)(y,{isOpen:m,onClose:()=>x(!1),onSubmit:T,initialAmount:h,initialToAddress:g,initialCurrency:n,initialMemoId:b,initialMemo:j})]})};function N(e){let{onAuth:t}=e,[r,n]=(0,l.useState)("signin"),[i,o]=(0,l.useState)(""),[c,u]=(0,l.useState)(""),[m,x]=(0,l.useState)(""),[h,p]=(0,l.useState)(""),[g,f]=(0,l.useState)(""),[b,v]=(0,l.useState)(!1),[j,y]=(0,l.useState)(""),[w,N]=(0,l.useState)(!1),k=async e=>{if(e.preventDefault(),y(""),N(!0),("create"===r||"import"===r)&&c!==m){y("Passwords do not match"),N(!1);return}try{await Promise.resolve().then(s.bind(s,849)).then(e=>{let{apiService:t}=e,s=window.ACTIVE_ACCOUNT;s&&(console.log("Cleaning up previous account before authentication"),t.abortRequestsForAddress(s),t.clearCache(s))})}catch(e){console.error("Error during pre-auth cleanup:",e)}let a="";if("signin"===r)a="/auth/signin";else if("create"===r||"import"===r)a="/auth/create";else{y("Invalid mode for submission.");return}try{console.log("Sending POST request to ".concat(a));let e=await d.apiService.post(a,{username:i,password:c,..."create"===r||"import"===r?{private_key:h,address:g}:{}});console.log("Auth data:",e),t(e.address,i,c),await C(e.address)}catch(e){console.error("Error in handleSubmit:",e),y(e instanceof Error?e.message:"An unknown error occurred")}finally{N(!1)}},S=async()=>{console.log("handleGenerateWallet called");try{console.log("Sending wallet generation request");let e=await d.apiService.post("/wallet/generate");console.log("Wallet data:",e),p(e.private_key),f(e.address)}catch(e){console.error("Error in handleGenerateWallet:",e),y(e instanceof Error?e.message:"An unknown error occurred")}},C=async e=>{try{await d.apiService.post("/tasks/clear-state/".concat(e)),console.log("Server state cleared for new account:",e),await d.apiService.post("/tasks/initialize/".concat(e)),console.log("Tasks initialized successfully for:",e),await d.apiService.post("/tasks/start-refresh/".concat(e)),console.log("Task refresh loop started for:",e)}catch(e){console.error("Task initialization error:",e)}};return"create"===r?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-950",children:(0,a.jsxs)("div",{className:"bg-slate-900 p-8 rounded-lg border border-slate-800 w-full max-w-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white mb-6",children:"Create New Wallet"}),(0,a.jsx)("button",{type:"button",onClick:S,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg mb-4",children:"Generate New XRP Wallet"}),h&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-yellow-900/30 border border-yellow-700 rounded-lg",children:[(0,a.jsx)("p",{className:"text-yellow-500 text-sm font-medium",children:(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"Important Warning"]})}),(0,a.jsxs)("p",{className:"text-yellow-400 text-sm mt-1",children:["Please save your XRP Secret in a secure location. If you lose it, it ",(0,a.jsx)("span",{className:"font-bold",children:"cannot be recovered"})," and you will permanently lose access to your funds."]})]}),(0,a.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[g&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"XRP Address"}),(0,a.jsx)("input",{type:"text",value:g,readOnly:!0,className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white"})]}),h&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"XRP Secret"}),(0,a.jsx)("button",{type:"button",onClick:()=>v(!b),className:"text-xs text-slate-400 hover:text-slate-300",children:b?"Hide Secret":"Show Secret"})]}),(0,a.jsx)("input",{type:b?"text":"password",value:h,readOnly:!0,className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Username"}),(0,a.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",value:c,onChange:e=>u(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0,minLength:8})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Confirm Password"}),(0,a.jsx)("input",{type:"password",value:m,onChange:e=>x(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0,minLength:8})]}),j&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:j}),(0,a.jsx)("button",{type:"submit",disabled:!h||!g,className:"w-full ".concat(h&&g?"bg-blue-600 hover:bg-blue-700":"bg-blue-600/50"," text-white font-medium py-2 px-4 rounded-lg"),children:"Create Account"})]}),(0,a.jsxs)("div",{className:"mt-4 text-center space-y-2",children:[(0,a.jsx)("button",{onClick:()=>{n("import"),p(""),f("")},className:"text-blue-400 hover:text-blue-300 text-sm",children:"Import Existing Wallet"}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:()=>{n("signin"),p(""),f("")},className:"text-blue-400 hover:text-blue-300 text-sm",children:"Back to Sign In"})})]})]})}):"import"===r?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-950",children:(0,a.jsxs)("div",{className:"bg-slate-900 p-8 rounded-lg border border-slate-800 w-full max-w-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white mb-6",children:"Import Existing Wallet"}),(0,a.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"XRP Address"}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"XRP Secret"}),(0,a.jsx)("button",{type:"button",onClick:()=>v(!b),className:"text-xs text-slate-400 hover:text-slate-300",children:b?"Hide Secret":"Show Secret"})]}),(0,a.jsx)("input",{type:b?"text":"password",value:h,onChange:e=>p(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Username"}),(0,a.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",value:c,onChange:e=>u(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0,minLength:8})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Confirm Password"}),(0,a.jsx)("input",{type:"password",value:m,onChange:e=>x(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0,minLength:8})]}),j&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:j}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg",children:"Import Wallet"})]}),(0,a.jsxs)("div",{className:"mt-4 text-center space-y-2",children:[(0,a.jsx)("button",{onClick:()=>{n("create"),p(""),f("")},className:"text-blue-400 hover:text-blue-300 text-sm",children:"Create New Wallet Instead"}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:()=>{n("signin"),p(""),f("")},className:"text-blue-400 hover:text-blue-300 text-sm",children:"Back to Sign In"})})]})]})}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-950",children:(0,a.jsxs)("div",{className:"bg-slate-900 p-8 rounded-lg border border-slate-800 w-full max-w-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white mb-6",children:"Sign In"}),(0,a.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Username"}),(0,a.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",value:c,onChange:e=>u(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0,minLength:8})]}),j&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:j}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg",children:"Sign In"})]}),(0,a.jsxs)("div",{className:"mt-6 grid grid-cols-1 gap-3",children:[(0,a.jsx)("p",{className:"text-center text-slate-400 text-sm",children:"Don't have a wallet?"}),(0,a.jsx)("button",{onClick:()=>{n("create"),p(""),f("")},className:"w-full bg-slate-800 hover:bg-slate-700 text-white font-medium py-2 px-4 rounded-lg border border-slate-700",children:"Create New Wallet"}),(0,a.jsx)("button",{onClick:()=>{n("import"),p(""),f("")},className:"w-full bg-slate-800 hover:bg-slate-700 text-white font-medium py-2 px-4 rounded-lg border border-slate-700",children:"Import Existing Wallet"})]})]})})}function k(e){let{username:t,onSignOut:s,activePage:l,onPageChange:r}=e;return(0,a.jsx)("nav",{className:"bg-slate-900 border-b border-slate-800",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between h-16",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("span",{className:"text-white font-bold text-xl",children:"Post Fiat Wallet"}),(0,a.jsx)("div",{className:"flex space-x-2",children:[{label:"Summary",id:"summary"},{label:"Active Tasks",id:"proposals"},{label:"Finished Tasks",id:"rewards"},{label:"Payments",id:"payments"},{label:"Memos",id:"memos"},{label:"Settings",id:"settings"}].map(e=>(0,a.jsx)("button",{onClick:()=>r(e.id),className:"px-4 py-2 rounded-md text-sm font-medium \n                    ".concat(l===e.id?"bg-slate-800 text-white":"text-slate-300 hover:bg-slate-800 hover:text-white"," \n                    transition-colors duration-200 ease-in-out"),children:e.label},e.id))})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("span",{className:"text-slate-300",children:t}),(0,a.jsx)("button",{onClick:s,className:"bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-lg text-sm",children:"Sign Out"})]})]})})})}let S=e=>{let{initStatus:t,address:s,onCheckStatus:r}=e,[n,i]=(0,l.useState)(null),{username:o,clearAuth:u}=(0,l.useContext)(c.cy),[x,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(!1),[f,b]=(0,l.useState)(""),[v,j]=(0,l.useState)(""),[y,w]=(0,l.useState)(!1),[N,k]=(0,l.useState)(""),[S,C]=(0,l.useState)(!1),E=async()=>{try{let e=await d.apiService.get("/balance/".concat(s));i(e)}catch(e){console.error("Error fetching balance:",e)}},_=async()=>{try{let e=await d.apiService.get("/account/".concat(s,"/status?refresh=true"));console.log("Status check result:",e),r({init_rite_status:e.init_rite_status})}catch(e){console.error("Error checking init status:",e),r({init_rite_status:"UNSTARTED"})}},A=async e=>{e.preventDefault(),h(!0)},P=async e=>{k(""),w(!0);try{let t=await d.apiService.post("/wallet/ecdhkey",{account:s,password:e}),a={account:s,password:e,username:o,initiation_rite:f,google_doc_link:v,ecdh_public_key:t.ecdh_public_key,use_pft_for_doc:!1},l=await d.apiService.post("/initiation/full-sequence",a);console.log("Initiation submitted successfully:",l),C(!0),r({init_rite_status:"PENDING_INITIATION"});let n=setInterval(async()=>{await _()},1e4);setTimeout(()=>{clearInterval(n),C(!1)},12e4)}catch(e){console.error("Error submitting initiation:",e),k(e instanceof Error?e.message:"Failed to submit initiation"),C(!1)}finally{w(!1),g(!1)}};return((0,l.useEffect)(()=>{E();let e=setInterval(E,1e4);return()=>clearInterval(e)},[s]),(0,l.useEffect)(()=>{if("PENDING_INITIATION"===t){let e=setInterval(()=>{_(),E()},1e4);return()=>clearInterval(e)}},[t,s,r]),["INITIATED","COMPLETE"].includes(t))?null:(0,a.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,a.jsx)("nav",{className:"bg-slate-900 border-b border-slate-800",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("span",{className:"text-white font-medium",children:o})}),(0,a.jsx)("button",{onClick:u,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Logout"})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"bg-slate-900 rounded-lg p-6 text-white",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Welcome to Post Fiat"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Wallet Address:"}),(0,a.jsx)("p",{className:"font-mono",children:s}),n&&(0,a.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["Balance: ",n.xrp," XRP / ",n.pft," PFT"]})]}),(()=>{let e=n?parseFloat(n.xrp):0;if(S)return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-white",children:"Initiation Submitted"}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500/10 to-blue-600/10 border border-blue-500/20 rounded-xl p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-blue-400 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-400",children:"Processing Your Initiation"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-300",children:"Your initiation has been submitted to the blockchain. It may take a minute or two to be confirmed."}),(0,a.jsx)("div",{className:"bg-slate-900/50 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-gray-400",children:"The page will automatically update once your initiation is confirmed. Please be patient."})}),(0,a.jsxs)("div",{className:"border-t border-blue-500/20 pt-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-400 mb-3",children:"What's happening now:"}),(0,a.jsxs)("ol",{className:"space-y-3 text-gray-300",children:[(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"1"}),(0,a.jsx)("span",{children:"Your initiation rite is being recorded on the XRP Ledger"})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"2"}),(0,a.jsx)("span",{children:"A secure connection is being established with the PostFiat node"})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"3"}),(0,a.jsx)("span",{children:"Your Google Doc link is being securely stored"})]})]})]})]})]})]});if(e<=0)return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-white",children:"Step 1: Fund Your Wallet"}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500/10 to-blue-600/10 border border-blue-500/20 rounded-xl p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-blue-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-400",children:"Wallet Funding Required"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-300",children:"Before you can complete the initiation process, you need at least 2 XRP in your wallet."}),(0,a.jsxs)("div",{className:"bg-slate-900/50 rounded-lg p-4",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Current balance:"}),(0,a.jsxs)("span",{className:"ml-2 text-xl font-medium text-white",children:[(null==n?void 0:n.xrp)||"0"," XRP"]})]}),(0,a.jsxs)("div",{className:"border-t border-blue-500/20 pt-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-400 mb-3",children:"To fund your wallet:"}),(0,a.jsxs)("ol",{className:"space-y-3 text-gray-300",children:[(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"1"}),(0,a.jsx)("span",{children:"Send XRP from another wallet or exchange"})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"2"}),(0,a.jsx)("span",{children:"Use your wallet address shown above"})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"3"}),(0,a.jsx)("span",{children:"Wait for the transaction to confirm"})]})]})]})]})]})]});switch(t){case"UNSTARTED":return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-white",children:"Step 2: Complete Initiation"}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500/10 to-blue-600/10 border border-blue-500/20 rounded-xl p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-blue-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-400",children:"Complete Your Initiation"})]}),(0,a.jsxs)("form",{onSubmit:A,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"initiation-rite",className:"block text-sm font-medium text-gray-300 mb-2",children:"Initiation Rite"}),(0,a.jsx)("textarea",{id:"initiation-rite",value:f,onChange:e=>b(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,placeholder:"Write your initiation rite here...",required:!0}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-400",children:"Your initiation rite should be a thoughtful statement about your intentions and goals."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"google-doc",className:"block text-sm font-medium text-gray-300 mb-2",children:"Google Doc Link"}),(0,a.jsx)("input",{type:"url",id:"google-doc",value:v,onChange:e=>j(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://docs.google.com/...",required:!0}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-400",children:"Share a Google Doc that contains your detailed background and interests."})]}),N&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:N}),(0,a.jsx)("div",{className:"pt-4 border-t border-slate-800",children:(0,a.jsxs)("button",{type:"submit",disabled:y,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)("span",{children:y?"Submitting...":"Submit Initiation"}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]})}),(0,a.jsxs)("div",{className:"bg-blue-900/20 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-blue-400 mb-2",children:"What happens next?"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-gray-300",children:[(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"h-4 w-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Create a trust line for the PFT token"]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"h-4 w-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Submit your initiation rite transaction"]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"h-4 w-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Send handshake transactions to the node and remembrancer"]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"h-4 w-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Submit your Google Doc context link"]})]})]})]})]}),x&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Confirm Initiation"}),(0,a.jsx)("p",{className:"text-gray-300 mb-4",children:"Are you sure you want to submit your initiation? This will:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-gray-300 mb-6 space-y-2",children:[(0,a.jsx)("li",{children:"Create a trust line for the PFT token"}),(0,a.jsx)("li",{children:"Submit your initiation rite"}),(0,a.jsx)("li",{children:"Set up secure communication with the network"}),(0,a.jsx)("li",{children:"Submit your context document"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>h(!1),className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{h(!1),g(!0)},className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors text-sm font-medium",children:"Confirm"})]})]})}),(0,a.jsx)(m,{isOpen:p,onClose:()=>g(!1),onConfirm:P,error:N})]});case"INITIATED":case"COMPLETE":return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Initiation Complete"}),(0,a.jsx)("p",{children:"Your account has been successfully initiated. You can now use the network."})]});case"PENDING":return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Initiation Pending"}),(0,a.jsx)("p",{children:"Your initiation request is being processed. Please check back soon."})]});case"REJECTED":return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Initiation Rejected"}),(0,a.jsx)("p",{children:"Your initiation request was not accepted. Please contact support for more information."})]});default:return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Account Setup Required"}),(0,a.jsx)("p",{children:"Additional setup is needed for your account."}),(0,a.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["Status: ",t]})]})}})()]})})]})},C=e=>{let{address:t}=e,{isAuthenticated:s,isCurrentAccount:r}=(0,c.Hr)(),n=(0,l.useContext)(c.cy),i="rJ1mBMhEBKack5uTQvM8vWoAntbufyG9Yn",[o,u]=(0,l.useState)("odv"),[x,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(!1),[f,b]=(0,l.useState)(null),[v,j]=(0,l.useState)(!1),[y,w]=(0,l.useState)(!1),[N,k]=(0,l.useState)(),[S,C]=(0,l.useState)(!1),[E,_]=(0,l.useState)(),[A,P]=(0,l.useState)(null),[I,T]=(0,l.useState)(!1),[R,D]=(0,l.useState)(null),[M,F]=(0,l.useState)(!1),[q,O]=(0,l.useState)(""),[L,z]=(0,l.useState)([{address:i,displayName:"ODV",lastMessage:"Greetings. I am ODV, a mediator between you and Future AI. I'm here to help translate strategic insights focused on life extension and wealth creation. How may I assist you today?",timestamp:Date.now(),unread:0}]),[W,V]=(0,l.useState)("ODV"),[B,U]=(0,l.useState)(!1),[H,G]=(0,l.useState)(null),[X,Y]=(0,l.useState)(""),[J,K]=(0,l.useState)([{id:"1",from:"ODV",to:t,content:"Greetings. I am ODV, a mediator between you and Future AI. I'm here to help translate strategic insights focused on life extension and wealth creation. How may I assist you today?",timestamp:Date.now()-1e3}]),[$,Q]=(0,l.useState)(""),[Z,ee]=(0,l.useState)(null),et=l.useRef(null),[es,ea]=(0,l.useState)(0),[el,er]=(0,l.useState)(!0),en=(0,l.useRef)(null),[ei,eo]=(0,l.useState)(0);(0,l.useEffect)(()=>{I&&J.length>0&&!x&&!v&&et.current&&(et.current.scrollTop=et.current.scrollHeight)},[J,I,x,v]);let ec=async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!r(t)){console.log("Skipping fetch for inactive account: ".concat(t)),h(!1),g(!1),j(!1);return}s?h(!0):g(!0);try{let a=e||R||n.password;if(!a){k(void 0),w(!0);return}let[l]=await Promise.all([d.apiService.post("/odv/messages/".concat(t),{password:a,refresh:s,since:!s&&es>0?es:void 0}),new Promise(e=>setTimeout(e,1e3))]);if("success"===l.status){if(ea(Math.floor(Date.now()/1e3)),s||!es){if(K(l.messages.map(e=>({id:e.id,from:e.from,to:e.to,content:e.content,timestamp:e.timestamp}))),l.messages.length>0){let e=l.messages[l.messages.length-1];z(t=>t.map(t=>t.address===i?{...t,lastMessage:e.content,timestamp:e.timestamp,unread:0}:t))}}else if(K(e=>{let t=new Map(e.map(e=>[e.id,e]));l.messages.forEach(e=>{t.set(e.id,{id:e.id,from:e.from,to:e.to,content:e.content,timestamp:e.timestamp})}),l.removed_message_ids&&l.removed_message_ids.forEach(e=>{t.delete(e)});let s=Array.from(t.values());return s.sort((e,t)=>e.timestamp-t.timestamp),s}),l.messages.length>0){let e=l.messages[l.messages.length-1];z(t=>t.map(t=>t.address===i?{...t,lastMessage:e.content,timestamp:e.timestamp,unread:0}:t))}T(!0),e&&!R&&(D(e),n.setPassword&&n.setPassword(e))}}catch(e){console.error("Error fetching messages:",e),b(e instanceof Error?e.message:"An error occurred"),"decryptMessages"===A&&_(e instanceof Error?e.message:"Failed to decrypt messages")}finally{h(!1),g(!1),j(!1),eo(Date.now())}},ed=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;if(!r(t)){console.log("Skipping refresh for inactive account: ".concat(t));return}if(null!==Z&&clearTimeout(Z),Date.now()-ei<1e4){console.log("Refresh throttled. Please wait before refreshing again.");return}let s=window.setTimeout(()=>{r(t)&&ec(void 0,!0),ee(null)},e);ee(Number(s))};(0,l.useEffect)(()=>{if(!t||!I||!s||!r(t)){console.log("Not starting refresh loop - inactive account: ".concat(t));return}console.log("Starting message refresh for current account: ".concat(t));let e=()=>{er(!document.hidden)};return en.current&&clearInterval(en.current),en.current=setInterval(()=>{!p&&"visible"===document.visibilityState&&r(t)?ec(void 0,!1):!r(t)&&(console.log("Stopping interval for inactive account: ".concat(t)),en.current&&(clearInterval(en.current),en.current=null))},3e4),document.addEventListener("visibilitychange",e),()=>{en.current&&(console.log("Cleaning up message refresh interval for: ".concat(t)),clearInterval(en.current),en.current=null),document.removeEventListener("visibilitychange",e)}},[t,I,s]),(0,l.useEffect)(()=>{el&&t&&I?(ec(void 0,!1),en.current&&clearInterval(en.current),en.current=setInterval(()=>{p||ec(void 0,!1)},3e4)):!el&&en.current&&(clearInterval(en.current),en.current=null)},[el,t,I]);let eu=async e=>{try{"sendMessage"===A?(await em(e),!R&&(D(e),n.setPassword&&n.setPassword(e))):"sendLog"===A?(await ex(e),!R&&(D(e),n.setPassword&&n.setPassword(e))):"decryptMessages"===A&&await ec(e),C(!1),P(null)}catch(e){console.error("Password operation failed:",e)}},em=async e=>{if(!$.trim()||!t){b("Please enter a message");return}h(!0);try{let s={account:t,password:e,message:$.trim(),amount_pft:1};console.log("Sending message request:",{url:"/odv/send_message",method:"POST",body:JSON.stringify({...s,password:"[REDACTED]"})});let a=await d.apiService.post("/odv/send_message",s);if(console.log("Parsed response data:",a),"success"===a.status){let e={id:a.message_id,from:t,to:i,content:$.trim(),timestamp:Date.now()};K(t=>[...t,e]),Q(""),z(e=>e.map(e=>e.address===i?{...e,lastMessage:$.trim(),timestamp:Date.now(),unread:0}:e)),ed(5e3)}}catch(e){throw console.error("Error sending message:",e),e instanceof Error?console.log("Error details:",{name:e.name,message:e.message,stack:e.stack}):console.log("Unknown error type:",e),b(e instanceof Error?e.message:"An error occurred"),_(e instanceof Error?e.message:"Failed to send message"),e}finally{h(!1)}},ex=async e=>{h(!0),b(null);try{let s=await d.apiService.post("/odv/send_log",{account:t,password:e,log_content:$.trim(),amount_pft:1}),a={id:"local_".concat(Date.now()),from:t,to:i,content:$.trim(),timestamp:Date.now()};K(e=>[...e,a]),Q(""),R||D(e),console.log("Log sent:",s),ed(3e3)}catch(e){console.error("Error sending log:",e),b(e.message)}finally{h(!1)}},eh=async()=>{if(!r(t)){console.log("Skipping send for inactive account: ".concat(t));return}if(!$.trim()){b("Please enter a message");return}let e=n.password||R;e?await em(e).catch(()=>{P("sendMessage"),_("Stored password is invalid. Please enter your password again."),C(!0),D(null),n.setPassword&&n.setPassword("")}):(P("sendMessage"),_(void 0),C(!0))},ep=()=>{if(!r(t)){console.log("Skipping log entry for inactive account: ".concat(t));return}if(!$.trim()){b("Please enter a log message");return}let e=n.password||R;e?ex(e).catch(()=>{P("sendLog"),_("Stored password is invalid. Please enter your password again."),C(!0),D(null),n.setPassword&&n.setPassword("")}):(P("sendLog"),_(void 0),C(!0))},eg=()=>{if(!r(t)){console.log("Skipping message send for inactive account: ".concat(t));return}"odv"===o?eh():"logging"===o&&ep()},ef=async e=>{if(!r(t)){console.log("Skipping decrypt for inactive account: ".concat(t));return}F(!0);try{await ec(e),w(!1)}catch(e){console.error("Error decrypting messages:",e),k(e instanceof Error?e.message:"Failed to decrypt messages")}finally{F(!1)}};(0,l.useEffect)(()=>{t&&(n.password?(j(!0),ec(n.password).catch(()=>{D(null),n.setPassword&&n.setPassword(""),T(!1),j(!1),k("Stored password is invalid. Please enter your password again."),w(!0)})):R?(j(!0),ec(R).catch(()=>{D(null),T(!1),j(!1),k("Stored password is invalid. Please enter your password again."),w(!0)})):I||(k(void 0),w(!0)))},[t]);let eb=(e,t)=>{t.stopPropagation(),G(e),Y(e.displayName),U(!0)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex h-[calc(100vh-120px)] overflow-hidden",children:[(0,a.jsxs)("div",{className:"w-1/4 min-w-[250px] border-r border-slate-700 flex flex-col",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:L.map(e=>(0,a.jsxs)("div",{onClick:()=>V(e.address),className:"p-4 cursor-pointer hover:bg-slate-800 relative ".concat(W===e.address?"bg-slate-800":""),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"font-medium text-slate-200",children:e.displayName}),(0,a.jsx)("button",{onClick:t=>eb(e,t),className:"text-slate-400 hover:text-slate-200 p-1 opacity-60 hover:opacity-100 transition-opacity",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 01.67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 11-.671-1.34l.041-.022zM12 9a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})})})]}),(0,a.jsx)("div",{className:"text-sm text-slate-400 truncate",children:e.lastMessage})]},e.address))}),(0,a.jsx)("div",{className:"border-t border-slate-700 p-4 sticky bottom-0 bg-slate-900",children:(0,a.jsxs)("div",{className:"flex rounded-lg overflow-hidden",children:[(0,a.jsx)("button",{onClick:()=>u("odv"),className:"flex-1 py-2 px-3 flex justify-center items-center transition-colors ".concat("odv"===o?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:"ODV Chat"}),(0,a.jsx)("button",{onClick:()=>u("logging"),className:"flex-1 py-2 px-3 flex justify-center items-center transition-colors ".concat("logging"===o?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:"Logging"})]})})]}),(0,a.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:W?(0,a.jsxs)(a.Fragment,{children:[f&&(0,a.jsxs)("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4 m-4",children:[(0,a.jsx)("p",{className:"text-red-400 text-sm",children:f}),(0,a.jsx)("button",{className:"text-xs text-red-400 hover:text-red-300 mt-2",onClick:()=>b(null),children:"Dismiss"})]}),(0,a.jsxs)("div",{ref:et,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[v?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"}),(0,a.jsx)("p",{className:"mt-4 text-slate-400",children:"Loading messages..."})]}):I?(0,a.jsxs)(a.Fragment,{children:[J.map((e,s)=>(0,a.jsx)("div",{className:"max-w-[70%] p-3 rounded-lg break-words overflow-hidden ".concat(e.from===t?"ml-auto bg-blue-600 text-white":"bg-slate-700 text-slate-200"),children:(0,a.jsx)("div",{className:"whitespace-pre-wrap break-words overflow-hidden",children:e.content})},"".concat(e.id||"msg","_").concat(s))),x&&(0,a.jsx)("div",{className:"flex justify-center items-center p-2 mt-2",children:(0,a.jsxs)("div",{className:"animate-pulse bg-blue-500/20 text-blue-300 px-4 py-2 rounded-full text-sm flex items-center",children:[(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4 mr-2",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Sending message..."]})})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[(0,a.jsx)("p",{children:"Messages need to be decrypted"}),(0,a.jsx)("button",{onClick:()=>{k(void 0),w(!0)},className:"mt-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Decrypt Messages"})]}),p&&!v&&(0,a.jsx)("div",{className:"flex justify-center items-center p-2",children:(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 text-slate-400",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]}),(0,a.jsx)("div",{className:"p-4 border-t border-slate-700 sticky bottom-0 bg-slate-900",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:$,onChange:e=>Q(e.target.value),onKeyPress:e=>"Enter"===e.key&&eg(),placeholder:"odv"===o?"Type a message...":"Type a log entry...",className:"flex-1 bg-slate-800 text-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:x||!I}),(0,a.jsx)("button",{onClick:eg,className:"bg-blue-600 text-white px-4 py-2 rounded-lg ".concat(x||!I?"opacity-50 cursor-not-allowed":"hover:bg-blue-700"),disabled:x||!I,children:x?"Sending...":"odv"===o?"Send":"Log"})]})})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center text-slate-400",children:"Select a conversation to start messaging"})})]}),B&&H&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-6 max-w-md w-full",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-slate-200 mb-4",children:"Thread Information"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Address"}),(0,a.jsx)("div",{className:"text-slate-200 bg-slate-700 p-2 rounded break-all",children:H.address})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Nickname"}),(0,a.jsx)("input",{type:"text",value:X,onChange:e=>Y(e.target.value),className:"w-full bg-slate-700 text-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>U(!1),className:"px-4 py-2 text-slate-400 hover:text-slate-200",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{H&&X.trim()&&(z(L.map(e=>e.address===H.address?{...e,displayName:X.trim()}:e)),U(!1))},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Save"})]})]})}),(0,a.jsx)(m,{isOpen:S,onClose:()=>{C(!1),P(null)},onConfirm:eu,error:E}),y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-slate-800 p-6 rounded-lg max-w-md w-full",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-slate-200 mb-4",children:"Decrypt Messages"}),(0,a.jsx)("p",{className:"text-slate-400 mb-4",children:"Enter your wallet password to decrypt messages"}),N&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded text-red-400 text-sm",children:N}),(0,a.jsx)("input",{type:"password",className:"w-full p-2 bg-slate-700 border border-slate-600 rounded mb-4 text-slate-200",placeholder:"Enter your password",value:q,onChange:e=>O(e.target.value),onKeyDown:e=>"Enter"===e.key&&ef(q)}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>w(!1),className:"px-4 py-2 bg-slate-700 text-slate-300 rounded hover:bg-slate-600",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>ef(q),disabled:M||!q.trim(),className:"px-4 py-2 rounded flex items-center justify-center min-w-[100px] ".concat(M||!q.trim()?"bg-blue-700/50 text-blue-300/50 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-300 border-t-transparent mr-2"}),"Decrypting..."]}):"Decrypt"})]})]})})]})},E=()=>{let{address:e,username:t}=(0,l.useContext)(c.cy),[s,r]=(0,l.useState)(""),[n,i]=(0,l.useState)(null),[o,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null),[h,p]=(0,l.useState)(!1),[g,f]=(0,l.useState)(!1),[b,v]=(0,l.useState)(!1),[j,y]=(0,l.useState)(!1),[w,N]=(0,l.useState)(null),[k,S]=(0,l.useState)(null),C=async t=>{t.preventDefault(),u(!0),x(null);try{let t=await d.apiService.post("/wallet/seed",{account:e,password:s});i(t.seed),p(!0),r("")}catch(e){console.error("Error retrieving seed:",e),x(e instanceof Error?e.message:"Failed to retrieve seed")}finally{u(!1)}},E=async t=>{N(null),S(null),"remembrancer"===t?v(!0):y(!0);try{await d.apiService.post("remembrancer"===t?"/transaction/handshake_remembrancer":"/transaction/handshake_node",{account:e,password:s,ecdh_public_key:"placeholder"}),S("Successfully sent handshake to ".concat(t,"!")),r("")}catch(e){console.error("Error sending handshake to ".concat(t,":"),e),N(e instanceof Error?e.message:"Failed to send handshake to ".concat(t))}finally{"remembrancer"===t?v(!1):y(!1)}};return(0,a.jsxs)("div",{className:"bg-slate-900 rounded-lg p-6 text-white",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Account Settings"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Account Information"}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 mb-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Username"}),(0,a.jsx)("p",{className:"font-medium",children:t})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Wallet Address"}),(0,a.jsx)("p",{className:"font-mono text-sm break-all",children:e})]})]}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Network Connections"}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 mb-6",children:[(0,a.jsx)("p",{className:"mb-4 text-sm text-gray-300",children:"Send handshake transactions to establish encrypted communication with network nodes."}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"handshake-password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Enter your password to authorize handshakes"}),(0,a.jsx)("input",{type:"password",id:"handshake-password",value:s,onChange:e=>r(e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3"})]}),w&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-800 rounded-md text-red-200 text-sm",children:w}),k&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-green-900/50 border border-green-800 rounded-md text-green-200 text-sm",children:k}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,a.jsx)("button",{onClick:()=>E("remembrancer"),disabled:b||j||!s,className:"bg-purple-600 hover:bg-purple-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white py-2 px-4 rounded-md transition duration-200 flex justify-center items-center",children:b?(0,a.jsx)("span",{children:"Sending..."}):(0,a.jsx)("span",{children:"Handshake Remembrancer"})}),(0,a.jsx)("button",{onClick:()=>E("node"),disabled:b||j||!s,className:"bg-teal-600 hover:bg-teal-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white py-2 px-4 rounded-md transition duration-200 flex justify-center items-center",children:j?(0,a.jsx)("span",{children:"Sending..."}):(0,a.jsx)("span",{children:"Handshake Task Node"})})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Backup & Security"}),h?(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h3",{className:"font-medium",children:"Your Seed Phrase"}),(0,a.jsx)("button",{onClick:()=>p(!1),className:"text-sm text-gray-400 hover:text-white",children:"Hide"})]}),(0,a.jsx)("div",{className:"bg-slate-900 border border-yellow-500/30 rounded-md p-3 mb-4",children:(0,a.jsx)("p",{className:"font-mono break-all text-yellow-400",children:n})}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Store this somewhere safe and secure"}),(0,a.jsx)("button",{onClick:()=>{n&&(navigator.clipboard.writeText(n),f(!0),setTimeout(()=>f(!1),2e3))},className:"bg-slate-700 hover:bg-slate-600 text-white text-sm py-1 px-3 rounded-md flex items-center",children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Copied"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,a.jsx)("path",{d:"M8 2a1 1 0 000 2h2a1 1 0 100-2H8z"}),(0,a.jsx)("path",{d:"M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z"})]}),"Copy"]})})]})]}):(0,a.jsxs)("form",{onSubmit:C,className:"bg-slate-800 rounded-lg p-4",children:[(0,a.jsxs)("p",{className:"mb-4 text-yellow-400",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 inline-block mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Never share your seed phrase with anyone. It provides full access to your wallet."]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Enter your password to reveal your seed phrase"}),(0,a.jsx)("input",{type:"password",id:"password",value:s,onChange:e=>r(e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),m&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-800 rounded-md text-red-200 text-sm",children:m}),(0,a.jsx)("button",{type:"submit",disabled:o||!s,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white py-2 px-4 rounded-md transition duration-200",children:o?"Loading...":"Reveal Seed Phrase"})]})]})]})]})};function _(e){let{isOpen:t,onRetry:s}=e;return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[100]",children:(0,a.jsx)("div",{className:"bg-slate-800 border border-slate-700 rounded-lg max-w-md w-full p-6 shadow-xl",children:(0,a.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,a.jsx)("div",{className:"mb-4 text-amber-500",children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"currentColor",viewBox:"0 0 16 16",children:[(0,a.jsx)("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}),(0,a.jsx)("path",{d:"M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"})]})}),(0,a.jsx)("h2",{className:"text-xl font-bold text-white mb-2",children:"Backend Service Unavailable"}),(0,a.jsx)("p",{className:"text-slate-300 mb-6",children:"The Post Fiat Wallet backend service is not responding. The wallet cannot function without a connection to the backend server."}),(0,a.jsxs)("div",{className:"bg-slate-700 rounded-lg p-4 mb-6 w-full text-left",children:[(0,a.jsx)("p",{className:"text-sm text-slate-300 mb-2",children:"Possible causes:"}),(0,a.jsxs)("ul",{className:"text-sm text-slate-400 list-disc pl-5 space-y-1",children:[(0,a.jsx)("li",{children:"The local server process has been terminated"}),(0,a.jsx)("li",{children:"There's a network connectivity issue"})]})]})]})})}):null}var A=s(2457);function P(){let[e,t]=(0,l.useState)("summary"),[s,r]=(0,l.useState)({isAuthenticated:!1,address:null,username:null,password:null}),[n,i]=(0,l.useState)(null),[o,m]=(0,l.useState)(!0),[x,h]=(0,l.useState)(!0),[p,g]=(0,l.useState)(null);(0,l.useEffect)(()=>{A.Up.startMonitoring(!1);let e=e=>{h(e.detail.isConnected)};return window.addEventListener(A.bE,e),A.Up.manualCheck(),()=>{A.Up.stopMonitoring(),window.removeEventListener(A.bE,e)}},[]),(0,l.useEffect)(()=>{A.Up.stopMonitoring(),A.Up.startMonitoring(s.isAuthenticated),A.Up.manualCheck()},[s.isAuthenticated]),(0,l.useEffect)(()=>{},[]),(0,l.useEffect)(()=>{let e=async()=>{if(s.address)try{console.log("Checking init status for address:",s.address);let e=await d.apiService.get("/account/".concat(s.address,"/status?refresh=true&nocache=").concat(Date.now()));console.log("Initiation status response:",e),i(e.init_rite_status||"UNSTARTED")}catch(e){console.error("Error checking initialization status:",e),i("UNSTARTED")}finally{m(!1)}};if(s.isAuthenticated&&x){e();let t=setInterval(()=>{e()},1e4);return()=>clearInterval(t)}m(!1)},[s.isAuthenticated,s.address,x]),(0,l.useEffect)(()=>{let e=async()=>{if(s.address&&s.isAuthenticated&&x)try{let e=await d.apiService.get("/balance/".concat(s.address));g(e),console.log("User balance:",e)}catch(e){console.error("Error fetching user balance:",e)}};s.isAuthenticated&&x&&e()},[s.isAuthenticated,s.address,x]);let f=async()=>{if(s.address){console.log("Cleaning up previous account before new login");try{await d.apiService.post("/tasks/stop-refresh/".concat(s.address)),d.apiService.clearCache(s.address),d.apiService.abortRequestsForAddress(s.address)}catch(e){console.error("Error during pre-auth cleanup:",e)}}},b=async(e,t,s)=>{await f(),r({isAuthenticated:!0,address:e,username:t,password:s}),d.apiService.setAuthenticated(!0)},y=async()=>{if(console.log("Signing out and resetting all state..."),localStorage.removeItem("wallet_address"),localStorage.removeItem("username"),localStorage.removeItem("auto_auth"),localStorage.removeItem("auth_token"),sessionStorage.clear(),window.ACTIVE_ACCOUNT=null,s.address&&x)try{let e=await fetch("/api/debug/reset",{method:"POST"}),t=await e.json();console.log("Server state reset complete on logout:",t)}catch(e){console.error("Error during sign out cleanup:",e)}r({isAuthenticated:!1,address:null,username:null,password:null}),i(null),t("summary"),d.apiService.setAuthenticated(!1),d.apiService.clearAllCache(),window.location.reload()};if(!x)return(0,a.jsx)("div",{className:"min-h-screen bg-slate-950",children:(0,a.jsx)(_,{isOpen:!0,onRetry:()=>{A.Up.manualCheck()}})});if(!s.isAuthenticated)return(0,a.jsx)(N,{onAuth:b});if(o)return(0,a.jsx)("div",{children:"Loading..."});if(n){let e=["UNSTARTED","PENDING_INITIATION","PENDING"].includes(n),t=p&&parseFloat(p.pft)>0;if(e&&!t)return(0,a.jsx)(c.OJ,{value:s,onClearAuth:y,children:(0,a.jsx)(S,{initStatus:n,address:s.address,onCheckStatus:e=>{i(e.init_rite_status)}})})}return(0,a.jsx)(c.OJ,{value:s,onClearAuth:y,children:(0,a.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,a.jsx)(k,{username:s.username,onSignOut:y,activePage:e,onPageChange:e=>{t(e)}}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:(()=>{switch(e){case"proposals":return(0,a.jsx)(v,{});case"rewards":return(0,a.jsx)(j,{});case"payments":return(0,a.jsx)(w,{});case"memos":return(0,a.jsx)(C,{address:s.address});case"settings":return(0,a.jsx)(E,{});default:return(0,a.jsx)(u,{})}})()})]})})}},9584:(e,t,s)=>{"use strict";s.d(t,{Hr:()=>o,OJ:()=>i,cy:()=>r});var a=s(5155),l=s(2115);let r=(0,l.createContext)({isAuthenticated:!1,address:null,username:null,password:null,clearAuth:async()=>{},setPassword:()=>{},isCurrentAccount:()=>!1});function n(){return window.ACTIVE_ACCOUNT}function i(e){let{children:t,value:i,onClearAuth:o}=e;void 0===window.ACTIVE_ACCOUNT&&(console.log("Initializing ACTIVE_ACCOUNT to null"),window.ACTIVE_ACCOUNT=null),(0,l.useEffect)(()=>{var e;console.log("Auth state changed, updating active account:",i.address);let t=n();t&&t!==i.address&&s.e(529).then(s.bind(s,849)).then(e=>{let{apiService:s}=e;console.log("Cleaning up resources for previous account: ".concat(t)),s.clearCache(t),s.abortRequestsForAddress(t)}),e=i.address,window.ACTIVE_ACCOUNT=e},[i.address]);let c=async()=>{s.e(529).then(s.bind(s,849)).then(e=>{let{apiService:t}=e;t.clearAllCache()}),await o()},d={...i,clearAuth:c,setPassword:e=>{i.password=e},isCurrentAccount:e=>null!==e&&e===n()};return(0,a.jsx)(r.Provider,{value:d,children:t})}function o(){let e=(0,l.useContext)(r),[t]=(0,l.useState)(()=>Math.random().toString(36).substr(2,9)),s=e.address===n();return(0,l.useEffect)(()=>(console.log("[".concat(t,"] Component using address: ").concat(e.address,", active: ").concat(s)),()=>{console.log("[".concat(t,"] Component unmounting, was using: ").concat(e.address))}),[e.address,t,s]),{address:s?e.address:null,isAuthenticated:s&&e.isAuthenticated,username:s?e.username:null,isCurrentAccount:e.isCurrentAccount}}},849:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ApiService:()=>o,apiService:()=>c});var a=s(2457);class l{clearAccountCache(e){for(let t of this.cache.keys())(t.includes("/account/".concat(e))||t.includes("/tasks/".concat(e)))&&this.cache.delete(t)}clearAllCache(){this.cache.clear()}clearTaskRelatedCache(){for(let e of this.cache.keys())e.includes("/tasks/")&&this.cache.delete(e)}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>this.maxAge?(this.cache.delete(e),null):t.data:null}set(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}constructor(){this.cache=new Map,this.maxAge=3e5}}let r=new l;class n{createAbortController(e){var t;let s=new AbortController;return e&&(this.activeRequests.has(e)||this.activeRequests.set(e,[]),null===(t=this.activeRequests.get(e))||void 0===t||t.push(s)),s}abortRequestsForAddress(e){e&&((this.activeRequests.get(e)||[]).forEach(e=>{try{e.abort()}catch(e){console.error("Error aborting request:",e)}}),this.activeRequests.set(e,[]))}constructor(){this.activeRequests=new Map}}let i=new n;class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}setAuthenticated(e){this.isAuthenticated=e,console.log("API Service: Authentication state set to ".concat(e))}isPublicEndpoint(e){return["/auth/signin","/auth/create","/wallet/generate","/wallet/address","/health","/server/status"].some(t=>e===t||e.startsWith(t))}async get(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(console.trace("API REQUEST ORIGIN: ".concat(e)),!this.isAuthenticated&&!this.isPublicEndpoint(e))throw console.warn("Blocked unauthenticated GET request to ".concat(e)),Error("Authentication required for ".concat(e));let s=this.getCacheKey(e),a=e.match(/\/account\/([^\/]+)\/|\/tasks\/([^\/]+)/),l=a?a[1]||a[2]:null;if(l&&null!==window.ACTIVE_ACCOUNT&&l!==window.ACTIVE_ACCOUNT)throw console.log("Skipping request for inactive account: ".concat(l)),Error("Account inactive");if(t){let t=r.get(s);if(t)return console.log("Using cached data for ".concat(e)),t}let n=i.createAbortController(l);try{o.logAllRequests&&console.log("API Request:",{endpoint:e,stackTrace:Error().stack,timestamp:new Date().toISOString()}),console.log("[API Request] GET ".concat(e));let a=await fetch("".concat(this.basePath).concat(e),{signal:n.signal});if(!a.ok){let e=await a.text();throw Error("API error (".concat(a.status,"): ").concat(e))}let l=await a.json();return t&&r.set(s,l),l}catch(t){throw t instanceof Error&&"AbortError"===t.name||console.error("API request failed for ".concat(e,":"),t),t}}async post(e,t){if(console.trace("API REQUEST ORIGIN: ".concat(e)),console.log("[API Request] POST ".concat(e),t?"(with data)":""),!this.isAuthenticated&&!this.isPublicEndpoint(e))throw console.warn("Blocked unauthenticated POST request to ".concat(e)),Error("Authentication required for ".concat(e));try{let s=await fetch("".concat(this.basePath).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:t?JSON.stringify(t):void 0});if(!s.ok){let e=await s.text();throw Error("API error (".concat(s.status,"): ").concat(e))}let a=await s.json(),l=e.match(/\/account\/([^\/]+)\/|\/tasks\/([^\/]+)|\/transaction\/[^\/]+/);if(l){let t=l[1]||l[2];t&&(console.log("Invalidating cache for address: ".concat(t," after POST to ").concat(e)),r.clearAccountCache(t))}return(e.includes("/tasks/")||e.includes("/transaction/"))&&(console.log("Invalidating all task-related cache entries after POST to ".concat(e)),r.clearTaskRelatedCache()),a}catch(e){throw e instanceof TypeError&&e.message.includes("fetch")&&a.Up.manualCheck(),e}}getCacheKey(e,t){return"".concat(e).concat(t?JSON.stringify(t):"")}clearCache(e){r.clearAccountCache(e),i.abortRequestsForAddress(e)}clearAllCache(){r.clearAllCache()}abortRequestsForAddress(e){i.abortRequestsForAddress(e)}constructor(){this.isAuthenticated=!1,this.basePath="/api",void 0===window.ACTIVE_ACCOUNT&&(window.ACTIVE_ACCOUNT=null),console.log("API Service initialized")}}o.logAllRequests=!0;let c=o.getInstance()},2457:(e,t,s)=>{"use strict";s.d(t,{Up:()=>n,bE:()=>l});var a=s(849);let l="connection_status_changed";class r{startMonitoring(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.intervalId&&this.stopMonitoring(),this._checkServerConnectivity(e),this.intervalId=setInterval(()=>{this._checkServerConnectivity(e)},5e3),console.log("Connection monitoring started (using ".concat(e?"authenticated":"basic"," endpoints)"))}stopMonitoring(){null!==this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null,console.log("Connection monitoring stopped"))}async checkConnection(){try{let e=await a.apiService.get("/health");if(e&&"object"==typeof e&&"status"in e&&"ok"===e.status)return this.isConnected||(this.isConnected=!0,this.dispatchConnectionEvent(!0)),!0;return this.isConnected&&(this.isConnected=!1,this.dispatchConnectionEvent(!1)),!1}catch(e){return console.error("Connection check failed:",e),this.isConnected&&(this.isConnected=!1,this.dispatchConnectionEvent(!1)),!1}}async manualCheck(){try{let e=await this.checkBasicConnectivity();return this.isConnected=e,this.dispatchConnectionEvent(e),e}catch(e){return this.isConnected=!1,this.dispatchConnectionEvent(!1),!1}}dispatchConnectionEvent(e){console.log("Connection status changed: ".concat(e?"connected":"disconnected"));let t=new CustomEvent(l,{detail:{isConnected:e}});window.dispatchEvent(t)}getConnectionStatus(){return this.isConnected}async checkBasicConnectivity(){try{let e=await fetch("/api/health",{method:"GET",headers:{"Content-Type":"application/json"}});if(e.ok){let t=await e.json();return t&&"ok"===t.status}return!1}catch(e){return console.error("Server connectivity check failed:",e),!1}}async _checkServerConnectivity(e){try{let e=await this.checkBasicConnectivity();e!==this.isConnected&&(this.isConnected=e,this.dispatchConnectionEvent(e))}catch(e){console.error("Error in connectivity check:",e),this.isConnected&&(this.isConnected=!1,this.dispatchConnectionEvent(!1))}}constructor(){this.intervalId=null,this.isConnected=!0}}let n=new r}},e=>{var t=t=>e(e.s=t);e.O(0,[441,517,358],()=>t(4905)),_N_E=e.O()}]);