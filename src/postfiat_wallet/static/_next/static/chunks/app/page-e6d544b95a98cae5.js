(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8148:(e,s,t)=>{Promise.resolve().then(t.bind(t,7475))},7475:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>T});var a=t(5155),l=t(2115);let r=e=>{let{children:s,className:t=""}=e;return(0,a.jsx)("div",{className:"rounded-lg border border-gray-700 bg-gray-800 ".concat(t),children:s})},n=e=>{let{children:s,className:t=""}=e;return(0,a.jsx)("div",{className:"p-6 pb-2 ".concat(t),children:s})},i=e=>{let{children:s,className:t=""}=e;return(0,a.jsx)("h3",{className:"text-lg font-semibold text-white ".concat(t),children:s})},o=e=>{let{children:s,className:t=""}=e;return(0,a.jsx)("div",{className:"p-6 ".concat(t),children:s})},d=(0,l.createContext)({isAuthenticated:!1,address:null,username:null,password:null,clearAuth:async()=>{}});function c(e){let{children:s,value:t,onClearAuth:l}=e,r={...t,clearAuth:l};return(0,a.jsx)(d.Provider,{value:r,children:s})}let m=()=>{let{address:e}=(0,l.useContext)(d),[s,t]=(0,l.useState)(null),[c,m]=(0,l.useState)(!0),[x,u]=(0,l.useState)(null),[h,p]=(0,l.useState)([]),[g,b]=(0,l.useState)(!0),[f,j]=(0,l.useState)(null),[y,v]=(0,l.useState)(new Set),[N,w]=(0,l.useState)(null),[k,S]=(0,l.useState)(!0),[C,_]=(0,l.useState)(!1),[E,P]=(0,l.useState)(null),[T,F]=(0,l.useState)(!1),I=async(s,t)=>{try{let a=await fetch("http://localhost:8000/api/decrypt/doc_link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:e,password:t,encrypted_link:s})});if(!a.ok){let e=await a.text();throw Error("Failed to decrypt link: ".concat(e))}return(await a.json()).link}catch(e){throw console.error("Error decrypting link:",e),e}},A=async e=>{if(e.includes("WHISPER__")){let s=e.substring(e.indexOf("WHISPER__"));_(!0),P({type:"decrypt_link",data:{link:s}})}else window.open(e,"_blank")},D=async e=>{if((null==E?void 0:E.type)==="decrypt_link")try{F(!0);let s=await I(E.data.link,e);window.open(s,"_blank")}catch(e){u("Failed to decrypt link: ".concat(e instanceof Error?e.message:String(e)))}finally{F(!1),_(!1),P(null)}};(0,l.useEffect)(()=>{(async()=>{if(!e){console.log("No address available"),m(!1);return}console.log("Fetching summary for address:",e);try{let s=await fetch("http://localhost:8000/api/account/".concat(e,"/summary"));if(console.log("API Response:",s),!s.ok){let e=await s.text();throw console.error("API Error:",e),Error("Failed to fetch account summary: ".concat(e))}let a=await s.json();console.log("Received summary:",a),t(a)}catch(e){console.error("Fetch error:",e),u(e instanceof Error?e.message:"An error occurred")}finally{m(!1)}})()},[e]),(0,l.useEffect)(()=>{(async()=>{if(!e){console.log("No address available for status check"),S(!1);return}console.log("Fetching account status for address:",e);try{let s=await fetch("http://localhost:8000/api/account/".concat(e,"/status?refresh=true"));if(console.log("Status API Response:",s),!s.ok){let e=await s.text();throw console.error("Status API Error:",e),Error("Failed to fetch account status: ".concat(e))}let t=await s.json();console.log("Received account status data:",JSON.stringify(t,null,2)),w(t)}catch(e){console.error("Status fetch error:",e)}finally{S(!1)}})()},[e]),(0,l.useEffect)(()=>{(async()=>{if(!e)return;let s=async()=>{try{b(!0);let s=await fetch("http://localhost:8000/api/tasks/".concat(e));if(!s.ok)throw Error("Failed to fetch tasks: ".concat(s.statusText));let t=await s.json(),a=[...t.requested||[],...t.proposed||[],...t.accepted||[],...t.challenged||[],...t.completed||[],...t.refused||[]],l=e=>{let s=e.split("__")[0].replace("_","T")+":00";return new Date(s).getTime()};a.sort((e,s)=>l(s.id)-l(e.id)),p(a.slice(0,10)),j(null)}catch(e){console.error("Error fetching tasks:",e),j(e instanceof Error?e.message:"Failed to fetch tasks")}finally{b(!1)}};await s();let t=setInterval(s,3e4);return()=>clearInterval(t)})()},[e]);let O=[{label:"XRP Balance",value:"number"==typeof(null==s?void 0:s.xrp_balance)?s.xrp_balance.toFixed(6):parseFloat((null==s?void 0:s.xrp_balance)||"0").toFixed(6)},{label:"PFT Balance",value:"number"==typeof(null==s?void 0:s.pft_balance)?s.pft_balance.toFixed(1):parseFloat((null==s?void 0:s.pft_balance)||"0").toFixed(1)}],R=[{label:"Account Address",value:e||"",copyable:!0},{label:"Task Node",value:"r4yc85M1hwsegVGZ1pawpZPwj65SVs8PzD",copyable:!0}],M=k?[]:[...(null==N?void 0:N.init_rite_statement)?[{label:"Initiation Rite",value:'"'.concat(N.init_rite_statement,'"'),className:"italic"}]:[],{label:"Initiation Status",value:(null==N?void 0:N.init_rite_status)||"Unknown",className:(null==N?void 0:N.init_rite_status)==="COMPLETED"?"text-green-400":(null==N?void 0:N.init_rite_status)==="PENDING"?"text-yellow-400":"text-slate-200"},{label:"Blacklist Status",value:(null==N?void 0:N.is_blacklisted)?"BLACKLISTED":"NOT BLACKLISTED",className:(null==N?void 0:N.is_blacklisted)?"text-red-400":"text-green-400"},...(null==N?void 0:N.sweep_address)?[{label:"Sweep Address",value:N.sweep_address,copyable:!0}]:[],...(null==N?void 0:N.context_doc_link)?[{label:"Context Document",value:"View Document",link:N.context_doc_link}]:[]].filter(e=>e),L=async e=>{try{await navigator.clipboard.writeText(e),console.log("Copied to clipboard: ".concat(e))}catch(e){console.error("Failed to copy:",e)}},q=e=>{v(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})};return c||k?(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsx)("div",{className:"grid grid-cols-2 gap-6",children:[1,2].map(e=>(0,a.jsx)("div",{className:"bg-slate-900 border-slate-800 rounded-lg p-6 animate-pulse",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"h-4 w-24 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-8 w-32 bg-slate-700 rounded"})]})},e))}),(0,a.jsxs)("div",{className:"bg-slate-900 border-slate-800 rounded-lg",children:[(0,a.jsx)("div",{className:"p-6 border-b border-slate-800",children:(0,a.jsx)("div",{className:"h-6 w-40 bg-slate-700 rounded animate-pulse"})}),(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[[1,2].map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-slate-800/50 animate-pulse",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-24 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-4 w-48 bg-slate-700 rounded"})]}),(0,a.jsx)("div",{className:"h-8 w-8 bg-slate-700 rounded"})]},e)),(0,a.jsxs)("div",{className:"border-t border-slate-800 pt-4 mt-4",children:[(0,a.jsx)("div",{className:"h-4 w-32 bg-slate-700 rounded mb-4 animate-pulse"}),[1,2,3,4].map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-slate-800/50 mb-4 animate-pulse",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-32 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-4 w-48 bg-slate-700 rounded"})]}),(0,a.jsx)("div",{className:"h-8 w-8 bg-slate-700 rounded"})]},e))]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-900 border-slate-800 rounded-lg",children:[(0,a.jsx)("div",{className:"p-6 border-b border-slate-800",children:(0,a.jsx)("div",{className:"h-6 w-40 bg-slate-700 rounded animate-pulse"})}),(0,a.jsx)("div",{className:"p-6 space-y-4",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"p-4 rounded-lg bg-slate-800/50 animate-pulse",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"h-4 w-32 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-4 w-20 bg-slate-700 rounded"})]}),(0,a.jsx)("div",{className:"h-4 w-3/4 bg-slate-700 rounded"}),(0,a.jsx)("div",{className:"h-4 w-24 bg-slate-700 rounded"})]})},e))})]})]}):x?(0,a.jsxs)("div",{className:"text-red-500",children:["Error: ",x]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("style",{children:"\n    @keyframes fade-in {\n      from { opacity: 0; }\n      to { opacity: 1; }\n    }\n    \n    .animate-fade-in {\n      animation: fade-in 0.5s ease-out;\n    }\n  "}),(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsx)("div",{className:"grid grid-cols-2 gap-6",children:O.map(e=>(0,a.jsx)(r,{className:"bg-slate-900 border-slate-800",children:(0,a.jsx)(o,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-400",children:e.label}),(0,a.jsx)("p",{className:"text-2xl font-semibold text-white mt-1",children:e.value})]})})},e.label))}),(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Account Details"})}),(0,a.jsx)(o,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[R.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-slate-800/50",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-400",children:e.label}),(0,a.jsx)("p",{className:"text-sm font-mono text-slate-200 mt-1",children:e.value})]}),e.copyable&&(0,a.jsx)("button",{onClick:()=>L(e.value),className:"p-2 rounded-md hover:bg-slate-700 text-slate-400 hover:text-white transition-colors",title:"Copy to clipboard",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})})})]},e.label)),M.length>0&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"border-t border-slate-800 pt-4 mt-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-400 mb-4",children:"Post Fiat Status"}),M.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-slate-800/50 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-400",children:e.label}),e.link?(0,a.jsx)("button",{onClick:()=>A(e.link),className:"text-blue-400 hover:underline hover:text-blue-300 text-sm mt-1",children:e.value}):(0,a.jsx)("p",{className:"text-sm mt-1 ".concat(e.className||"text-slate-200"),children:e.value})]}),e.copyable&&(0,a.jsx)("button",{onClick:()=>L(e.value),className:"p-2 rounded-md hover:bg-slate-700 text-slate-400 hover:text-white transition-colors",title:"Copy to clipboard",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})})})]},s))]})})]})})]}),(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Recent Activity"})}),(0,a.jsx)(o,{className:"max-h-[400px] overflow-y-auto",children:g?(0,a.jsx)("div",{className:"text-white",children:"Loading tasks..."}):f?(0,a.jsxs)("div",{className:"text-red-500",children:["Error: ",f]}):0===h.length?(0,a.jsx)("div",{className:"text-slate-500",children:"No recent activity"}):(0,a.jsx)("div",{className:"space-y-4",children:h.map(e=>{let s=e.id.split("__")[0].replace("_"," ");return(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-slate-800/50 hover:bg-slate-800 transition-colors",children:[(0,a.jsxs)("div",{className:"cursor-pointer",onClick:()=>q(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-slate-400",children:e.message_history&&e.message_history.length>0?e.message_history[0].direction.charAt(0).toUpperCase()+e.message_history[0].direction.slice(1):"Unknown"}),(0,a.jsx)("span",{className:"text-xs font-mono text-slate-500",children:e.id})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700 text-slate-300",children:e.status}),(0,a.jsx)("svg",{className:"w-4 h-4 text-slate-400 transition-transform ".concat(y.has(e.id)?"transform rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]})]}),(0,a.jsx)("p",{className:"text-sm text-slate-300 mb-2",children:e.message_history&&e.message_history.length>0?e.message_history[0].data:"No message available"}),(0,a.jsx)("p",{className:"text-xs text-slate-500",children:s})]}),y.has(e.id)&&e.message_history&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-slate-400 mb-2",children:"Message History"}),(0,a.jsx)("div",{className:"space-y-3",children:Array.from(new Map(e.message_history.map(e=>["".concat(e.direction,":").concat(e.data),e])).values()).map((e,s)=>(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"text-slate-400 font-medium",children:[e.direction.charAt(0).toUpperCase()+e.direction.slice(1),":"]}),(0,a.jsx)("p",{className:"text-slate-300 mt-1 pl-4",children:e.data})]},s))})]})]},e.id)})})})]})]}),C&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-white mb-4",children:"Enter Password"}),(0,a.jsx)("p",{className:"text-slate-400 mb-4",children:"Your password is needed to decrypt the document link."}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),D(e.currentTarget.elements.namedItem("password").value)},children:[(0,a.jsx)("input",{type:"password",name:"password",className:"w-full p-3 bg-slate-800 border border-slate-700 rounded-md text-white mb-4",placeholder:"Your wallet password",required:!0}),x&&(0,a.jsx)("div",{className:"text-red-400 mb-4",children:x}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{_(!1),P(null)},className:"px-4 py-2 bg-slate-800 text-white rounded-md hover:bg-slate-700",disabled:T,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center",disabled:T,children:T?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Confirm"})]})]})]})})]})};function x(e){let{isOpen:s,onClose:t,onConfirm:r,error:n}=e,[i,o]=(0,l.useState)(""),[d,c]=(0,l.useState)(!1);if(!s)return null;let m=async e=>{e.preventDefault(),c(!0);try{await r(i),o("")}finally{c(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-md",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Confirm Password"}),(0,a.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-300",children:"Enter your password to sign this transaction"}),(0,a.jsx)("input",{type:"password",value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Password",required:!0})]}),n&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:n}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Confirming...":"Confirm"})]})]})]})})})}let u=e=>{let{isOpen:s,onClose:t,taskId:r,onAccept:n,initialMessage:i}=e,[o,c]=(0,l.useState)(i),[m,u]=(0,l.useState)(!1),[h,p]=(0,l.useState)(""),[g,b]=(0,l.useState)(!1),{address:f,username:j,password:y}=(0,l.useContext)(d);if((0,l.useEffect)(()=>{c(i)},[i]),!s)return null;let v=async e=>{if(e.preventDefault(),!y){b(!0);return}await N(y)},N=async e=>{p(""),u(!0);try{let s={account:f,tx_type:"task_acceptance",password:e,data:{message:o,task_id:r,username:j}};console.log("Sending request data:",{...s,password:"[REDACTED]"});let a=await fetch("http://localhost:8000/api/transaction/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){let e=await a.json();throw console.error("Full error response:",e),Error(e.detail||"Failed to send transaction")}let l=await a.json();console.log("Success response:",l),n(r,o),c(""),t()}catch(e){console.error("Error accepting task:",e),p(e instanceof Error?e.message:"Failed to accept task")}finally{u(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Accept Task"}),(0,a.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Task ID"}),(0,a.jsx)("input",{type:"text",value:r,disabled:!0,className:"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Acceptance Message"}),(0,a.jsx)("textarea",{value:o,onChange:e=>c(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[100px]",placeholder:"Enter your acceptance message...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(o.length>=950?"text-amber-400":"text-slate-500"),children:[o.length,"/1000"]})})]}),h&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:h}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Sending...":"Accept Task"})]})]})]})})}),(0,a.jsx)(x,{isOpen:g,onClose:()=>b(!1),onConfirm:async e=>{b(!1),await N(e)},error:h})]})};function h(e){let{isOpen:s,onClose:t,onRequest:r,initialMessage:n}=e,[i,o]=(0,l.useState)(n),[c,m]=(0,l.useState)(!1),[u,h]=(0,l.useState)(""),[p,g]=(0,l.useState)(!1),{address:b,username:f,password:j}=(0,l.useContext)(d);if((0,l.useEffect)(()=>{o(n)},[n]),!s)return null;let y=async e=>{if(e.preventDefault(),!j){g(!0);return}await v(j)},v=async e=>{h(""),m(!0);try{let s=function(){let e=new Date,s="ABCDEFGHIJKLMNOPQRSTUVWXYZ",t="0123456789",a=Array.from({length:2},()=>s[Math.floor(Math.random()*s.length)]).join(""),l=Array.from({length:2},()=>t[Math.floor(Math.random()*t.length)]).join(""),r=e.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+),\s(\d+):(\d+)/,"$3-$1-$2_$4:$5");return"".concat(r,"__").concat(a).concat(l)}(),a={account:b,tx_type:"task_request",password:e,data:{request:i,task_id:s,username:f}};console.log("Sending request data:",{...a,password:"[REDACTED]"});let l=await fetch("http://localhost:8000/api/transaction/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok){let e=await l.json();throw console.error("Full error response:",e),Error(e.detail||"Failed to send transaction")}let n=await l.json();console.log("Success response:",n),r(i),o(""),t()}catch(e){console.error("Error sending task request:",e),h(e instanceof Error?e.message:"Failed to send request")}finally{m(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Request Task"}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-300",children:"Task Request Message"}),(0,a.jsx)("textarea",{value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Enter your task request...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(i.length>=950?"text-amber-400":"text-slate-500"),children:[i.length,"/1000"]})})]}),u&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:u}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Sending...":"Submit Request"})]})]})]})})}),(0,a.jsx)(x,{isOpen:p,onClose:()=>g(!1),onConfirm:async e=>{g(!1),await v(e)},error:u})]})}let p=e=>{let{isOpen:s,onClose:t,taskId:r,onRefuse:n,initialReason:i}=e,[o,c]=(0,l.useState)(i),[m,u]=(0,l.useState)(!1),[h,p]=(0,l.useState)(""),[g,b]=(0,l.useState)(!1),{address:f,username:j,password:y}=(0,l.useContext)(d);if((0,l.useEffect)(()=>{c(i)},[i]),!s)return null;let v=async e=>{if(e.preventDefault(),!y){b(!0);return}await N(y)},N=async e=>{p(""),u(!0);try{let s={account:f,tx_type:"task_refusal",password:e,data:{refusal_reason:o,task_id:r,username:j}};console.log("Sending request data:",{...s,password:"[REDACTED]"});let a=await fetch("http://localhost:8000/api/transaction/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){let e=await a.json();throw console.error("Full error response:",e),Error(e.detail||"Failed to send transaction")}let l=await a.json();console.log("Success response:",l),n(r,o),c(""),t()}catch(e){console.error("Error refusing task:",e),p(e instanceof Error?e.message:"Failed to refuse task")}finally{u(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Refuse Task"}),(0,a.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Task ID"}),(0,a.jsx)("input",{type:"text",value:r,disabled:!0,className:"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Reason for Refusal"}),(0,a.jsx)("textarea",{value:o,onChange:e=>c(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[100px]",placeholder:"Enter reason for refusing the task...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(o.length>=950?"text-amber-400":"text-slate-500"),children:[o.length,"/1000"]})})]}),h&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:h}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-red-600 hover:bg-red-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Sending...":"Refuse Task"})]})]})]})})}),(0,a.jsx)(x,{isOpen:g,onClose:()=>b(!1),onConfirm:async e=>{b(!1),await N(e)},error:h})]})},g=e=>{let{isOpen:s,onClose:t,taskId:r,onSubmit:n,initialDetails:i}=e,[o,c]=(0,l.useState)(i),[m,u]=(0,l.useState)(!1),[h,p]=(0,l.useState)(""),[g,b]=(0,l.useState)(!1),{address:f,username:j,password:y}=(0,l.useContext)(d);if((0,l.useEffect)(()=>{c(i)},[i]),!s)return null;let v=async e=>{if(e.preventDefault(),!y){b(!0);return}await N(y)},N=async e=>{p(""),u(!0);try{let s={account:f,tx_type:"task_completion",password:e,data:{completion_justification:o,task_id:r,username:j}};console.log("Sending request data:",{...s,password:"[REDACTED]"});let a=await fetch("http://localhost:8000/api/transaction/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){let e=await a.json();throw console.error("Full error response:",e),Error(e.detail||"Failed to send transaction")}let l=await a.json();console.log("Success response:",l),n(r,o),c(""),t()}catch(e){console.error("Error submitting completion:",e),p(e instanceof Error?e.message:"Failed to submit completion")}finally{u(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Submit for Verification"}),(0,a.jsxs)("form",{onSubmit:v,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Task ID"}),(0,a.jsx)("input",{type:"text",value:r,disabled:!0,className:"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Verification Details"}),(0,a.jsx)("textarea",{value:o,onChange:e=>c(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[200px]",placeholder:"Enter verification details...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(o.length>=950?"text-amber-400":"text-slate-500"),children:[o.length,"/1000"]})})]}),h&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:h}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Sending...":"Submit Verification"})]})]})]})})}),(0,a.jsx)(x,{isOpen:g,onClose:()=>b(!1),onConfirm:async e=>{b(!1),await N(e)},error:h})]})},b=e=>{let{isOpen:s,onClose:t,taskId:r,onSubmit:n,initialDetails:i,verificationPrompt:o}=e,[c,m]=(0,l.useState)(i),[u,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(""),[b,f]=(0,l.useState)(!1),{address:j,username:y,password:v}=(0,l.useContext)(d);if((0,l.useEffect)(()=>{m(i)},[i]),!s)return null;let N=async e=>{if(e.preventDefault(),!v){f(!0);return}await w(v)},w=async e=>{g(""),h(!0);try{let s={account:j,tx_type:"verification_response",password:e,data:{verification_response:c,task_id:r,username:y}};console.log("Sending request data:",{...s,password:"[REDACTED]"});let a=await fetch("http://localhost:8000/api/transaction/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){let e=await a.json();throw console.error("Full error response:",e),Error(e.detail||"Failed to send transaction")}let l=await a.json();console.log("Success response:",l),n(r,c),m(""),t()}catch(e){console.error("Error submitting verification response:",e),g(e instanceof Error?e.message:"Failed to submit verification response")}finally{h(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Submit Verification Response"}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Task ID"}),(0,a.jsx)("input",{type:"text",value:r,disabled:!0,className:"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500"})]}),o&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Verification Prompt"}),(0,a.jsx)("div",{className:"w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-lg  text-slate-300 text-sm max-h-[150px] overflow-y-auto",children:o})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Verification Response"}),(0,a.jsx)("textarea",{value:c,onChange:e=>m(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[200px]",placeholder:"Enter your verification response...",required:!0,maxLength:1e3}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("span",{className:"text-xs ".concat(c.length>=950?"text-amber-400":"text-slate-500"),children:[c.length,"/1000"]})})]}),p&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:p}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Sending...":"Submit Response"})]})]})]})})}),(0,a.jsx)(x,{isOpen:b,onClose:()=>f(!1),onConfirm:async e=>{f(!1),await w(e)},error:p})]})},f=e=>{let{isOpen:s,onClose:t,onSubmit:r,initialDetails:n}=e,[i,o]=(0,l.useState)(n),[c,m]=(0,l.useState)(!1),[u,h]=(0,l.useState)(""),[p,g]=(0,l.useState)(!1),{address:b,username:f,password:j}=(0,l.useContext)(d);if((0,l.useEffect)(()=>{o(n)},[n]),!s)return null;let y=async e=>{if(e.preventDefault(),!j){g(!0);return}await v(j)},v=async e=>{h(""),m(!0);try{let s="pomo_".concat(Date.now()),a={account:b,password:e,log_message:i,log_id:s,username:f,use_pft:!0};console.log("Sending PF Log request:",{...a,password:"[REDACTED]"});let l=await fetch("http://localhost:8000/api/transaction/pf_log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok){let e=await l.json();throw console.error("PF Log error response:",e),Error(e.detail||"Failed to send PF log transaction")}let n=await l.json();console.log("PF Log success response:",n),r(i),t()}catch(e){console.error("Error submitting PF log:",e),h(e instanceof Error?e.message:"Failed to submit PF log")}finally{m(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Submit Pomodoro Log"}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Log Message"}),(0,a.jsx)("textarea",{value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[200px]",placeholder:"Enter your log message...",required:!0})]}),u&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:u}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Sending...":"Submit Log"})]})]})]})})}),(0,a.jsx)(x,{isOpen:p,onClose:()=>g(!1),onConfirm:async e=>{g(!1),await v(e)},error:u})]})},j=()=>{let{isAuthenticated:e,address:s,username:t,password:c}=(0,l.useContext)(d),[m,x]=(0,l.useState)([]),[j,y]=(0,l.useState)(!0),[v,N]=(0,l.useState)(null),[w,k]=(0,l.useState)(!1),[S,C]=(0,l.useState)(new Set),[_,E]=(0,l.useState)(new Set),[P,T]=(0,l.useState)(""),[F,I]=(0,l.useState)({accept:!1,request:!1,refuse:!1,verify:!1,finalVerify:!1,logPomodoro:!1,verificationPrompt:""}),[A,D]=(0,l.useState)(null),[O,R]=(0,l.useState)(!1),[M,L]=(0,l.useState)("all"),q=async()=>{if(!s){y(!1);return}R(!0);try{let[e]=await Promise.all([fetch("http://localhost:8000/api/tasks/".concat(s)),new Promise(e=>setTimeout(e,1e3))]);if(!e.ok){let s=await e.text();throw Error("Failed to fetch tasks: ".concat(s))}let t=await e.json(),a=[...t.requested||[],...t.proposed||[],...t.accepted||[],...t.challenged||[],...w&&t.refused||[]],l=e=>{let s=e.split("__")[0].replace("_","T")+":00";return new Date(s).getTime()};a.sort((e,s)=>l(s.id)-l(e.id)),x(a)}catch(e){N(e instanceof Error?e.message:"An error occurred")}finally{y(!1),R(!1)}};(0,l.useEffect)(()=>{if(e&&s)return(async()=>{try{await fetch("http://localhost:8000/api/tasks/start-refresh/".concat(s),{method:"POST"}),console.log("Started task refresh loop")}catch(e){console.error("Failed to start refresh loop:",e)}})(),q(),()=>{s&&fetch("http://localhost:8000/api/tasks/stop-refresh/".concat(s),{method:"POST"}).catch(e=>{console.error("Failed to stop refresh loop:",e)})}},[e,s]),(0,l.useEffect)(()=>{if(!e||!s)return;let t=setInterval(()=>{q()},3e4);return()=>clearInterval(t)},[e,s]),(0,l.useEffect)(()=>{q()},[w]);let z=e=>{C(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},W=e=>{E(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},V=e=>{T(e)},B=e=>{if("request"!==e&&"logPomodoro"!==e&&(!P||!m.some(e=>e.id===P))){D("Please select a valid task first");return}D(null);let s="";if("verify"===e||"finalVerify"===e){var t;let e=m.find(e=>e.id===P);(null==e?void 0:null===(t=e.message_history)||void 0===t?void 0:t.length)>=5&&(s=e.message_history[4].data)}I({...F,[e]:!0,verificationPrompt:s})},H=e=>{I({...F,[e]:!1}),D(null)},U=async(e,s)=>{console.log("Accepting task:",e,s),H("accept"),await q()},J=async e=>{console.log("Requesting task:",e),H("request"),await q()},G=async(e,s)=>{console.log("Refusing task:",e,s),H("refuse"),await q()},X=async(e,s)=>{try{console.log("Verification submitted:",e,s),H("verify"),await q()}catch(e){console.error("Error handling verification submission:",e)}},Y=async(e,s)=>{try{console.log("Final verification submitted:",e,s),H("finalVerify"),await q()}catch(e){console.error("Error handling final verification:",e)}},K=async e=>{try{console.log("Pomodoro logged:",e),H("logPomodoro"),await q()}catch(e){console.error("Error logging pomodoro:",e)}},$=m.filter(e=>"all"===M||e.status===M),Z=e=>{var s;return(null===(s=e.message_history)||void 0===s?void 0:s.length)?"proposed"===e.status&&e.message_history.length>=2?e.message_history[1].data:"accepted"===e.status&&e.message_history.length>=3?e.message_history[2].data:"challenged"===e.status&&e.message_history.length>=5?e.message_history[4].data:e.message_history[0].data:"No message available"},Q=(e,s)=>e.length<=300||_.has(s)?(0,a.jsx)("p",{className:"text-sm text-slate-300",children:e}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-slate-300",children:[e.substring(0,300),"..."]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),W(s)},className:"text-xs text-emerald-400 hover:text-emerald-300 mt-1",children:"Show more"})]}),ee=e=>{switch(e.status){case"proposed":return(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),T(e.id),B("accept")},className:"px-3 py-1 text-xs font-medium bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors",children:"Accept"}),(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),T(e.id),B("refuse")},className:"px-3 py-1 text-xs font-medium bg-slate-700 hover:bg-slate-600  text-white rounded-lg transition-colors",children:"Refuse"})]});case"accepted":return(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),T(e.id),B("verify")},className:"px-3 py-1 text-xs font-medium bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors",children:"Submit for Verification"}),(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),T(e.id),B("refuse")},className:"px-3 py-1 text-xs font-medium bg-slate-700 hover:bg-slate-600  text-white rounded-lg transition-colors",children:"Refuse"})]});case"challenged":return(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),T(e.id),B("finalVerify")},className:"px-3 py-1 text-xs font-medium bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors",children:"Submit Verification Details"}),(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),T(e.id),B("refuse")},className:"px-3 py-1 text-xs font-medium bg-slate-700 hover:bg-slate-600  text-white rounded-lg transition-colors",children:"Refuse"})]});default:return null}};return j?(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:[1,2,3,4].map(e=>(0,a.jsx)("div",{className:"h-10 w-24 bg-slate-800 rounded-lg animate-pulse"},e))}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-10 w-28 bg-emerald-600/50 rounded-lg animate-pulse"}),(0,a.jsx)("div",{className:"h-10 w-24 bg-slate-800 rounded-lg animate-pulse"})]})]}),(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)("div",{className:"h-6 w-32 bg-slate-700 rounded animate-pulse"})}),(0,a.jsx)(o,{className:"max-h-[600px] overflow-y-auto space-y-4",children:[1,2,3,4].map(e=>(0,a.jsx)("div",{className:"p-4 rounded-lg bg-slate-800/50",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-4 w-48 bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-5 w-20 bg-blue-500/10 rounded-full animate-pulse"})]}),(0,a.jsx)("div",{className:"h-7 w-28 bg-slate-700 rounded-full animate-pulse"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-full bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-3/4 bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-1/2 bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-3 w-32 bg-slate-700 rounded animate-pulse mt-2"})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)("div",{className:"h-7 w-24 bg-emerald-600/50 rounded-lg animate-pulse"}),(0,a.jsx)("div",{className:"h-7 w-20 bg-slate-700 rounded-lg animate-pulse"})]})]})},e))})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("style",{children:"\n    @keyframes fade-in {\n      from { opacity: 0; }\n      to { opacity: 1; }\n    }\n    \n    .animate-fade-in {\n      animation: fade-in 0.5s ease-out;\n    }\n  "}),(0,a.jsxs)("div",{className:"space-y-6",children:[!e&&(0,a.jsx)("div",{className:"text-white",children:"Please sign in to view tasks."}),e&&!s&&(0,a.jsx)("div",{className:"text-white",children:"No wallet address found."}),v&&(0,a.jsxs)("div",{className:"text-red-500",children:["Error: ",v]}),e&&s&&!j&&(0,a.jsxs)(a.Fragment,{children:[A&&(0,a.jsx)("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4 mb-4",children:(0,a.jsx)("p",{className:"text-red-400 text-sm",children:A})}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:[(0,a.jsx)("button",{onClick:()=>L("all"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("all"===M?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"All Tasks"}),(0,a.jsx)("button",{onClick:()=>L("proposed"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("proposed"===M?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Proposed"}),(0,a.jsx)("button",{onClick:()=>L("accepted"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("accepted"===M?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Accepted"}),(0,a.jsx)("button",{onClick:()=>L("challenged"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("challenged"===M?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Verification"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:()=>B("request"),className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium",children:"Request Task"}),(0,a.jsx)("button",{onClick:()=>q(),disabled:O,className:"px-4 py-2 bg-slate-800 hover:bg-slate-700  text-white rounded-lg transition-all duration-200 text-sm font-medium disabled:opacity-75 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:O?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{children:"Updating..."})]}):"Update"})]})]}),(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Active Tasks"})}),(0,a.jsx)(o,{className:"max-h-[600px] overflow-y-auto",children:0===$.length?(0,a.jsx)("div",{className:"text-slate-500",children:"No tasks available."}):(0,a.jsx)("div",{className:"space-y-4",children:$.map(e=>{let s=e.id.split("__")[0].replace("_"," "),t=Z(e);return(0,a.jsx)("div",{className:"p-4 rounded-lg bg-slate-800/50 hover:bg-slate-800 transition-colors cursor-pointer",onClick:()=>V(e.id),children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs font-mono text-slate-500",children:e.id}),(0,a.jsx)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("accepted"===e.status?"bg-emerald-500/10 text-emerald-400":"requested"===e.status?"bg-yellow-500/10 text-yellow-400":"proposed"===e.status?"bg-blue-500/10 text-blue-400":"challenged"===e.status?"bg-purple-500/10 text-purple-400":"bg-red-500/10 text-red-400"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]}),(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),z(e.id)},className:"px-3 py-1 text-xs font-medium text-slate-400 hover:text-white  bg-slate-700/50 hover:bg-slate-700 rounded-full transition-colors",children:S.has(e.id)?"Hide Messages":"Show Messages"})]}),(0,a.jsxs)("div",{children:[Q(t,e.id),(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:s})]}),ee(e),S.has(e.id)&&e.message_history&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-slate-400 mb-2",children:"Message History"}),(0,a.jsx)("div",{className:"space-y-3",children:Array.from(new Map(e.message_history.map(e=>["".concat(e.direction,":").concat(e.data),e])).values()).map((e,s)=>(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"text-slate-400 font-medium",children:[e.direction,":"]}),(0,a.jsx)("p",{className:"text-slate-300 mt-1 pl-4",children:e.data})]},s))})]})]})},e.id)})})})]}),(0,a.jsx)(u,{isOpen:F.accept,onClose:()=>H("accept"),taskId:P,onAccept:(e,s)=>{U(e,s)},initialMessage:""}),(0,a.jsx)(h,{isOpen:F.request,onClose:()=>H("request"),onRequest:e=>{J(e)},initialMessage:""}),(0,a.jsx)(p,{isOpen:F.refuse,onClose:()=>H("refuse"),taskId:P,onRefuse:(e,s)=>{G(e,s)},initialReason:""}),(0,a.jsx)(g,{isOpen:F.verify,onClose:()=>H("verify"),taskId:P,onSubmit:(e,s)=>{X(e,s)},initialDetails:""}),(0,a.jsx)(b,{isOpen:F.finalVerify,onClose:()=>H("finalVerify"),taskId:P,onSubmit:(e,s)=>{Y(e,s)},initialDetails:"",verificationPrompt:F.verificationPrompt}),(0,a.jsx)(f,{isOpen:F.logPomodoro,onClose:()=>H("logPomodoro"),onSubmit:K,initialDetails:""})]})]})]})},y=()=>{let{isAuthenticated:e,address:s}=(0,l.useContext)(d),[t,c]=(0,l.useState)([]),[m,x]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null),[g,j]=(0,l.useState)(new Set),[y,v]=(0,l.useState)(""),[N,w]=(0,l.useState)(!1),[k,S]=(0,l.useState)(!1),[C,_]=(0,l.useState)(""),[E,P]=(0,l.useState)(!1),[T,F]=(0,l.useState)(!1),[I,A]=(0,l.useState)(""),D=async()=>{if(!s){x(!1);return}P(!0);try{let[e]=await Promise.all([fetch("http://localhost:8000/api/tasks/".concat(s)),new Promise(e=>setTimeout(e,1e3))]);if(!e.ok){let s=await e.text();throw Error("Failed to fetch tasks: ".concat(s))}let t=(await e.json()).challenged||[],a=e=>{let s=e.split("__")[0].replace("_","T")+":00";return new Date(s).getTime()};t.sort((e,s)=>a(s.id)-a(e.id)),c(t)}catch(e){h(e instanceof Error?e.message:"An error occurred")}finally{x(!1),P(!1)}};(0,l.useEffect)(()=>{if(!e||!s)return;D();let t=setInterval(D,3e4);return()=>clearInterval(t)},[e,s]),(0,l.useEffect)(()=>{A("Please provide verification details for this task.")},[]);let O=e=>{j(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},R=(e,s)=>{D()},M=(e,s)=>{D()},L=async e=>{_(""),D()};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Submit Verification"})}),(0,a.jsxs)(o,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Task ID"}),(0,a.jsx)("input",{type:"text",value:y,onChange:e=>v(e.target.value),className:"w-full px-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Enter task ID"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-400",children:"Verification Details"}),(0,a.jsx)("textarea",{value:C,onChange:e=>_(e.target.value),className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50 min-h-[200px]",placeholder:"Enter verification details"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:()=>w(!0),className:"w-full px-4 py-2.5 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium",children:"Submit Verification Details"}),(0,a.jsx)("button",{onClick:()=>S(!0),className:"w-full px-4 py-2.5 bg-slate-800 hover:bg-slate-700  text-white rounded-lg transition-colors text-sm font-medium",children:"Refuse"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:()=>F(!0),className:"w-full px-4 py-2.5 bg-slate-800 hover:bg-slate-700  text-white rounded-lg transition-colors text-sm font-medium",children:"Log Pomodoro"}),(0,a.jsx)("button",{onClick:()=>D(),disabled:E,className:"w-full px-4 py-2.5 bg-slate-800 hover:bg-slate-700  text-white rounded-lg transition-all duration-200 text-sm font-medium disabled:opacity-75 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:E?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("span",{children:"Updating..."})]}):"Force Update"})]})]})]})]}),(0,a.jsxs)(r,{className:"bg-slate-900 border-slate-800",children:[(0,a.jsx)(n,{children:(0,a.jsx)(i,{className:"text-lg font-semibold text-white",children:"Verification History"})}),(0,a.jsx)(o,{children:m?(0,a.jsx)("div",{className:"text-slate-500",children:"Loading tasks..."}):u?(0,a.jsxs)("div",{className:"text-red-500",children:["Error: ",u]}):0===t.length?(0,a.jsx)("div",{className:"text-slate-500",children:"No tasks available for verification."}):(0,a.jsx)("div",{className:"space-y-4",children:t.map(e=>{var s,t;let l=e.id.split("__")[0].replace("_"," "),r=(null===(t=e.message_history)||void 0===t?void 0:null===(s=t[4])||void 0===s?void 0:s.data)||"No verification message available";return(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-slate-800/50 cursor-pointer hover:bg-slate-800",onClick:()=>v(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs font-mono text-slate-400",children:e.id}),(0,a.jsx)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700 text-slate-300",children:"Challenged"})]}),(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),O(e.id)},className:"px-3 py-1 text-xs font-medium text-slate-400 hover:text-white  bg-slate-700/50 hover:bg-slate-700 rounded-full transition-colors",children:g.has(e.id)?"Hide Messages":"Show Messages"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-slate-400 mb-1",children:"Verification Message"}),(0,a.jsx)("p",{className:"text-sm text-slate-300",children:r}),(0,a.jsx)("p",{className:"text-xs text-slate-500 mt-2",children:l})]}),g.has(e.id)&&e.message_history&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-700",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-slate-400 mb-2",children:"Message History"}),(0,a.jsx)("div",{className:"space-y-3",children:e.message_history.map((e,s)=>(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"text-slate-400 font-medium",children:[e.direction.charAt(0).toUpperCase()+e.direction.slice(1),":"]}),(0,a.jsx)("p",{className:"text-slate-300 mt-1 pl-4",children:e.data})]},s))})]})]})]},e.id)})})})]}),(0,a.jsx)(b,{isOpen:N,onClose:()=>w(!1),taskId:y,onSubmit:(e,s)=>{R(e,s),_("")},initialDetails:C,verificationPrompt:I}),(0,a.jsx)(p,{isOpen:k,onClose:()=>S(!1),taskId:y,onRefuse:(e,s)=>{M(e,s),_("")},initialReason:C}),(0,a.jsx)(f,{isOpen:T,onClose:()=>F(!1),onSubmit:L,initialDetails:C})]})},v=()=>{let{isAuthenticated:e,address:s}=(0,l.useContext)(d),[t,r]=(0,l.useState)([]),[n,i]=(0,l.useState)(!0),[o,c]=(0,l.useState)(null),[m,x]=(0,l.useState)("all"),u=async()=>{if(!s){i(!1);return}try{let e=await fetch("http://localhost:8000/api/tasks/".concat(s));if(!e.ok){let s=await e.text();throw Error("Failed to fetch tasks: ".concat(s))}let t=await e.json(),a=[...t.rewarded||[],...t.refused||[]];a=a.map(e=>{var s;return(null===(s=t.rewarded)||void 0===s?void 0:s.some(s=>s.id===e.id))?{...e,status:"rewarded"}:{...e,status:"refused"}});let l=e=>{let s=e.split("__")[0].replace("_","T")+":00";return new Date(s).getTime()};a.sort((e,s)=>l(s.id)-l(e.id)),r(a)}catch(e){c(e instanceof Error?e.message:"An error occurred")}finally{i(!1)}};(0,l.useEffect)(()=>{if(!e||!s)return;u();let t=setInterval(()=>{u()},3e4);return()=>clearInterval(t)},[e,s]);let h=t.filter(e=>"all"===m||e.status===m),p="\n    @keyframes fade-in {\n      from { opacity: 0; }\n      to { opacity: 1; }\n    }\n    \n    .animate-fade-in {\n      animation: fade-in 0.5s ease-out;\n    }\n  ";return n?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4 space-y-6 animate-fade-in",children:[(0,a.jsx)("style",{children:p}),(0,a.jsx)("div",{className:"h-8 w-48 bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"flex space-x-4 mb-4",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"h-10 w-24 bg-slate-700 rounded-lg animate-pulse"},e))}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-gray-900 z-10",children:(0,a.jsx)("tr",{className:"border-b border-gray-700",children:["Task ID","Proposal","Reward/Refusal","Payout"].map((e,s)=>(0,a.jsx)("th",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-24 bg-slate-700 rounded animate-pulse"})},s))})}),(0,a.jsx)("tbody",{children:[1,2,3,4,5].map(e=>(0,a.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-48 bg-slate-700 rounded animate-pulse"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-full bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-3/4 bg-slate-700 rounded animate-pulse"})]})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-full bg-slate-700 rounded animate-pulse"}),(0,a.jsx)("div",{className:"h-4 w-2/3 bg-slate-700 rounded animate-pulse"})]})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-20 bg-slate-700 rounded animate-pulse"})})]},e))})]})})})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 text-gray-100 p-4",children:[(0,a.jsx)("style",{children:p}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Finished Tasks"}),!e&&(0,a.jsx)("div",{className:"text-white",children:"Please sign in to view your finished tasks."}),e&&!s&&(0,a.jsx)("div",{className:"text-white",children:"No wallet address found."}),o&&(0,a.jsxs)("div",{className:"text-red-500",children:["Error: ",o]}),e&&s&&!n&&(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsxs)("div",{className:"flex space-x-4 mb-4",children:[(0,a.jsx)("button",{onClick:()=>x("all"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("all"===m?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"All Tasks"}),(0,a.jsx)("button",{onClick:()=>x("rewarded"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("rewarded"===m?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Rewarded"}),(0,a.jsx)("button",{onClick:()=>x("refused"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat("refused"===m?"bg-emerald-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:"Refused"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-gray-900 z-10",children:(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Task ID"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Proposal"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Reward/Refusal"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Payout"})]})}),(0,a.jsx)("tbody",{children:0===h.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"p-4 text-gray-400 text-center",children:"No tasks available."})}):h.map(e=>{var s,t;let l=e.message_history&&e.message_history.length>1?e.message_history[1].data:"No proposal available",r="rewarded"===e.status&&(null===(s=e.message_history)||void 0===s?void 0:s.length)>1?e.message_history[e.message_history.length-1].data:null,n="refused"===e.status&&(null===(t=e.message_history)||void 0===t?void 0:t.length)>1?e.message_history[e.message_history.length-1].data:null,i="rewarded"===e.status&&r?r:"refused"===e.status&&n?n:"No response available";return(0,a.jsxs)("tr",{className:"border-b border-gray-800 hover:bg-gray-800/50",children:[(0,a.jsx)("td",{className:"p-4 text-gray-300 font-mono align-top whitespace-nowrap",children:e.id}),(0,a.jsx)("td",{className:"p-4 text-gray-300 align-top max-w-md",children:(0,a.jsx)("div",{className:"line-clamp-4",children:l})}),(0,a.jsx)("td",{className:"p-4 text-gray-300 align-top max-w-lg",children:(0,a.jsx)("div",{className:"line-clamp-4",children:i})}),(0,a.jsx)("td",{className:"p-4 text-gray-300 align-top whitespace-nowrap",children:"rewarded"===e.status?"".concat(e.pft_rewarded||e.pft_offered||"N/A"," PFT"):""})]},e.id)})})]})})})]})]})};function N(e){let{isOpen:s,onClose:t,onSubmit:r,initialAmount:n,initialToAddress:i,initialCurrency:o,initialMemoId:c,initialMemo:m}=e,{address:u}=(0,l.useContext)(d),[h,p]=(0,l.useState)(n),[g,b]=(0,l.useState)(i),[f,j]=(0,l.useState)(o),[y,v]=(0,l.useState)(c||""),[N,w]=(0,l.useState)(m||""),[k,S]=(0,l.useState)(!1),[C,_]=(0,l.useState)(""),[E,P]=(0,l.useState)(!1);if((0,l.useEffect)(()=>{p(n),b(i),j(o),v(c||""),w(m||"")},[n,i,o,c,m]),!s)return null;let T=async e=>{if(e.preventDefault(),!h||!g){_("Amount and destination address are required");return}P(!0)},F=async e=>{_(""),S(!0);try{let s=await fetch("http://localhost:8000/api/transaction/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from_account:u,to_address:g,amount:h,currency:f,password:e,memo_id:y||void 0,memo:N||void 0})});if(console.log("Payment request:",{from_account:u,to_address:g,amount:h,currency:f,password:"[REDACTED]",memo_id:y||void 0,memo:N||void 0}),!s.ok){let e=await s.json();throw console.error("Payment error response:",e),Error(e.detail||"Failed to send payment")}let a=await s.json();console.log("Payment success response:",a),t()}catch(e){console.error("Error sending payment:",e),_(e instanceof Error?e.message:"Failed to send payment")}finally{S(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Send Payment"}),(0,a.jsxs)("form",{onSubmit:T,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:h,readOnly:!0,className:"flex-1 px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Amount",required:!0}),(0,a.jsxs)("select",{value:f,disabled:!0,className:"px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",children:[(0,a.jsx)("option",{value:"XRP",children:"XRP"}),(0,a.jsx)("option",{value:"PFT",children:"PFT"})]})]}),(0,a.jsx)("input",{type:"text",value:g,readOnly:!0,className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Destination Address",required:!0}),(0,a.jsx)("input",{type:"text",value:y,readOnly:!0,className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Memo ID (Optional)"}),(0,a.jsx)("input",{type:"text",value:N,readOnly:!0,className:"w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg  text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2  focus:ring-emerald-500/50 focus:border-emerald-500/50",placeholder:"Memo (Optional)"})]}),C&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:C}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:k,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500  text-white rounded-lg transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:k?"Sending...":"Send Payment"})]})]})]})})}),(0,a.jsx)(x,{isOpen:E,onClose:()=>P(!1),onConfirm:async e=>{P(!1),await F(e)},error:C})]})}let w=()=>{let{address:e}=(0,l.useContext)(d),[s,t]=(0,l.useState)("XRP"),[r,n]=(0,l.useState)([]),[i,o]=(0,l.useState)(!1),[c,m]=(0,l.useState)(""),[x,u]=(0,l.useState)(""),[h,p]=(0,l.useState)(""),[g,b]=(0,l.useState)(""),[f,j]=(0,l.useState)("idle"),[y,v]=(0,l.useState)(""),[w,k]=(0,l.useState)(!0),S=async()=>{if(e){k(!0);try{let s=await fetch("http://localhost:8000/api/payments/".concat(e));if(!s.ok)throw Error("Failed to load payments");let t=(await s.json()).payments.sort((e,s)=>new Date(s.timestamp).getTime()-new Date(e.timestamp).getTime());n(t)}catch(e){console.error("Error fetching payments:",e)}finally{k(!1)}}};(0,l.useEffect)(()=>{S()},[e]);let C=async(s,t,a,l,r)=>{j("loading"),v("");try{let n=await fetch("http://localhost:8000/api/transaction/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from_account:e,to_address:t,amount:s,currency:a,memo_id:l||void 0,memo:r||void 0})});if(!n.ok){let e=await n.json();throw Error(e.detail||"Failed to send payment")}m(""),u(""),p(""),b(""),j("success"),await S()}catch(e){throw v(e.message),j("error"),e}};return(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-gray-900 text-gray-100",children:[(0,a.jsxs)("div",{className:"flex-none p-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Payments"}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!c||!x){v("Amount and destination address are required");return}o(!0)},className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{type:"text",value:c,onChange:e=>m(e.target.value),placeholder:"Send Amount",className:"w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:s,onChange:e=>t(e.target.value),className:"bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none pr-8",children:[(0,a.jsx)("option",{value:"XRP",children:"XRP"}),(0,a.jsx)("option",{value:"PFT",children:"PFT"})]}),(0,a.jsx)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),(0,a.jsx)("input",{type:"text",value:x,onChange:e=>u(e.target.value),placeholder:"To Address",className:"w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"Memo ID (optional)",className:"w-full bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("input",{type:"text",value:g,onChange:e=>b(e.target.value),placeholder:"Memo (Optional)",className:"flex-1 bg-gray-800 border border-gray-700 rounded-md p-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 mr-2"}),(0,a.jsx)("button",{type:"submit",className:"bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-2 rounded-md transition-colors",children:"Send"})]})]})]}),y&&(0,a.jsx)("div",{className:"text-red-500 text-sm mt-2",children:y})]})]}),(0,a.jsx)("div",{className:"flex-1 min-h-0",children:(0,a.jsx)("div",{className:"h-full overflow-y-auto px-4",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-gray-900 z-10",children:(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"#"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Date"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Amount"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Token"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"To/From"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Address"}),(0,a.jsx)("th",{className:"p-4 text-gray-400 font-normal",children:"Tx Hash"})]})}),(0,a.jsx)("tbody",{children:w?[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsxs)("tr",{className:"border-b border-gray-800 animate-pulse",children:[(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-8 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-24 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-16 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-12 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-8 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-32 bg-gray-700 rounded"})}),(0,a.jsx)("td",{className:"p-4",children:(0,a.jsx)("div",{className:"h-4 w-40 bg-gray-700 rounded"})})]},"skeleton-".concat(s))):0===r.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"text-center p-8 text-gray-400",children:"No transactions found"})}):r.map((s,t)=>(0,a.jsxs)("tr",{className:"border-b border-gray-800 hover:bg-gray-800/50",children:[(0,a.jsx)("td",{className:"p-4 text-gray-300",children:t+1}),(0,a.jsx)("td",{className:"p-4 text-gray-300 whitespace-nowrap",children:s.timestamp}),(0,a.jsx)("td",{className:"p-4 text-gray-300",children:s.amount_xrp>0?s.amount_xrp:s.amount_pft}),(0,a.jsx)("td",{className:"p-4 text-gray-300",children:s.amount_xrp>0?"XRP":s.amount_pft>0?"PFT":""}),(0,a.jsx)("td",{className:"p-4 text-gray-300",children:s.from_address===e?"To":"From"}),(0,a.jsx)("td",{className:"p-4 text-gray-300 font-mono",children:s.from_address===e?s.to_address:s.from_address}),(0,a.jsx)("td",{className:"p-4 text-gray-300 font-mono",children:(0,a.jsxs)("a",{href:"https://livenet.xrpl.org/transactions/".concat(s.hash),target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 hover:underline",children:[s.hash.substring(0,10),"..."]})})]},t))})]})})}),(0,a.jsx)(N,{isOpen:i,onClose:()=>o(!1),onSubmit:C,initialAmount:c,initialToAddress:x,initialCurrency:s,initialMemoId:h,initialMemo:g})]})};function k(e){let{onAuth:s}=e,[t,r]=(0,l.useState)("signin"),[n,i]=(0,l.useState)(""),[o,d]=(0,l.useState)(""),[c,m]=(0,l.useState)(""),[x,u]=(0,l.useState)(""),[h,p]=(0,l.useState)(""),[g,b]=(0,l.useState)(!1),[f,j]=(0,l.useState)(""),[y,v]=(0,l.useState)(!1),N=async e=>{if(e.preventDefault(),j(""),v(!0),"signup"===t&&o!==c){j("Passwords do not match");return}let a="";if("signin"===t)a="/api/auth/signin";else if("generate"===t)a="/api/auth/create";else{j("Invalid mode for submission.");return}try{console.log("Sending POST request to http://localhost:8000".concat(a));let e=await fetch("http://localhost:8000".concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:o,..."generate"===t&&{private_key:x,address:h}})});if(console.log("Response for auth:",e),!e.ok){let s=await e.json();throw console.error("Auth error response:",s),Error(s.detail||"Authentication failed")}let l=await e.json();console.log("Auth data:",l);try{let e=await fetch("http://localhost:8000/api/tasks/initialize/".concat(l.address),{method:"POST"});if(console.log("Response status:",e.status),console.log("Response headers:",Object.fromEntries(e.headers)),!e.ok){let s=await e.text();throw console.error("Error response:",s),Error("Failed to initialize tasks: ".concat(s))}}catch(e){throw console.error("Fetch error:",e),e}"generate"===t?(i(""),d(""),u(""),p(""),r("signin"),j("Account created successfully! Please sign in.")):s(l.address,n,o)}catch(e){console.error("Error in handleSubmit:",e),j(e instanceof Error?e.message:"An unknown error occurred")}finally{v(!1)}},w=async()=>{console.log("handleGenerateWallet called");try{console.log("Sending POST request to http://localhost:8000/api/wallet/generate");let e=await fetch("http://localhost:8000/api/wallet/generate",{method:"POST",headers:{"Content-Type":"application/json"}});if(console.log("Response for wallet generation:",e),!e.ok){let s=await e.json();throw console.error("Wallet generation error response:",s),Error(s.detail||"Failed to generate wallet")}let s=await e.json();console.log("Wallet data:",s),u(s.private_key),p(s.address)}catch(e){console.error("Error in handleGenerateWallet:",e),j(e instanceof Error?e.message:"An unknown error occurred")}};return"generate"===t?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-950",children:(0,a.jsxs)("div",{className:"bg-slate-900 p-8 rounded-lg border border-slate-800 w-full max-w-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white mb-6",children:"Create New Wallet"}),x&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-yellow-900/30 border border-yellow-700 rounded-lg",children:[(0,a.jsx)("p",{className:"text-yellow-500 text-sm font-medium",children:(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"Important Warning"]})}),(0,a.jsxs)("p",{className:"text-yellow-400 text-sm mt-1",children:["Please save your XRP Secret in a secure location. If you lose it, it ",(0,a.jsx)("span",{className:"font-bold",children:"cannot be recovered"})," and you will permanently lose access to your funds."]})]}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"XRP Address"}),(0,a.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"XRP Secret"}),(0,a.jsx)("button",{type:"button",onClick:()=>b(!g),className:"text-xs text-slate-400 hover:text-slate-300",children:g?"Hide Secret":"Show Secret"})]}),(0,a.jsx)("input",{type:g?"text":"password",value:x,onChange:e=>u(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Username"}),(0,a.jsx)("input",{type:"text",value:n,onChange:e=>i(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",value:o,onChange:e=>d(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0,minLength:8})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Confirm Password"}),(0,a.jsx)("input",{type:"password",value:c,onChange:e=>m(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0,minLength:8})]}),f&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:f}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{type:"button",onClick:w,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg",children:"Generate New XRP Wallet"}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg",children:"Create Account"})]})]}),(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)("button",{onClick:()=>r("signin"),className:"text-blue-400 hover:text-blue-300 text-sm",children:"Back to Sign In"})})]})}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-950",children:(0,a.jsxs)("div",{className:"bg-slate-900 p-8 rounded-lg border border-slate-800 w-full max-w-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white mb-6",children:"signin"===t?"Sign In":"Create New Wallet"}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Username"}),(0,a.jsx)("input",{type:"text",value:n,onChange:e=>i(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",value:o,onChange:e=>d(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-white",required:!0,minLength:8})]}),f&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:f}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg",children:"signin"===t?"Sign In":"Create Wallet"})]}),(0,a.jsx)("div",{className:"mt-4 text-center space-y-2",children:"signin"===t&&(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:()=>r("generate"),className:"text-blue-400 hover:text-blue-300 text-sm",children:"Create a new Account"})})})]})})}function S(e){let{username:s,onSignOut:t,activePage:l,onPageChange:r}=e;return(0,a.jsx)("nav",{className:"bg-slate-900 border-b border-slate-800",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between h-16",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("span",{className:"text-white font-bold text-xl",children:"Post Fiat Wallet"}),(0,a.jsx)("div",{className:"flex space-x-2",children:[{label:"Summary",id:"summary"},{label:"Active Tasks",id:"proposals"},{label:"Finished Tasks",id:"rewards"},{label:"Payments",id:"payments"},{label:"Memos",id:"memos"},{label:"Settings",id:"settings"}].map(e=>(0,a.jsx)("button",{onClick:()=>r(e.id),className:"px-4 py-2 rounded-md text-sm font-medium \n                    ".concat(l===e.id?"bg-slate-800 text-white":"text-slate-300 hover:bg-slate-800 hover:text-white"," \n                    transition-colors duration-200 ease-in-out"),children:e.label},e.id))})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("span",{className:"text-slate-300",children:s}),(0,a.jsx)("button",{onClick:t,className:"bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-lg text-sm",children:"Sign Out"})]})]})})})}let C=e=>{let{initStatus:s,address:t,onCheckStatus:r}=e,[n,i]=(0,l.useState)(null),{username:o,clearAuth:c}=(0,l.useContext)(d),[m,u]=(0,l.useState)(!1),[h,p]=(0,l.useState)(!1),[g,b]=(0,l.useState)(""),[f,j]=(0,l.useState)(""),[y,v]=(0,l.useState)(!1),[N,w]=(0,l.useState)(""),[k,S]=(0,l.useState)(!1),C=async()=>{try{let e=await fetch("http://localhost:8000/api/balance/".concat(t)),s=await e.json();i(s)}catch(e){console.error("Error fetching balance:",e)}},_=async()=>{try{let e=await fetch("http://localhost:8000/api/account/".concat(t,"/status?refresh=true")),s=await e.json();console.log("Status check result:",s),r({init_rite_status:s.init_rite_status})}catch(e){console.error("Error checking init status:",e),r({init_rite_status:"UNSTARTED"})}},E=async e=>{e.preventDefault(),u(!0)},P=async e=>{w(""),v(!0);try{let s=await fetch("http://localhost:8000/api/wallet/ecdhkey",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:t,password:e})});if(!s.ok)throw Error("Failed to generate ECDH key");let{ecdh_public_key:a}=await s.json(),l=await fetch("http://localhost:8000/api/initiation/full-sequence",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:t,password:e,username:o,initiation_rite:g,google_doc_link:f,ecdh_public_key:a,use_pft_for_doc:!1})});if(!l.ok){let e=await l.json();throw Error(e.detail||"Failed to submit initiation")}let n=await l.json();console.log("Initiation submitted successfully:",n),S(!0),r({init_rite_status:"PENDING_INITIATION"});let i=setInterval(async()=>{await _()},1e4);setTimeout(()=>{clearInterval(i),S(!1)},12e4)}catch(e){console.error("Error submitting initiation:",e),w(e instanceof Error?e.message:"Failed to submit initiation"),S(!1)}finally{v(!1),p(!1)}};return((0,l.useEffect)(()=>{C();let e=setInterval(C,1e4);return()=>clearInterval(e)},[t]),(0,l.useEffect)(()=>{if("PENDING_INITIATION"===s){let e=setInterval(()=>{_(),C()},1e4);return()=>clearInterval(e)}},[s,t,r]),["INITIATED","COMPLETE"].includes(s))?null:(0,a.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,a.jsx)("nav",{className:"bg-slate-900 border-b border-slate-800",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("span",{className:"text-white font-medium",children:o})}),(0,a.jsx)("button",{onClick:c,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium",children:"Logout"})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"bg-slate-900 rounded-lg p-6 text-white",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Welcome to Post Fiat"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Wallet Address:"}),(0,a.jsx)("p",{className:"font-mono",children:t}),n&&(0,a.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["Balance: ",n.xrp," XRP / ",n.pft," PFT"]})]}),(()=>{let e=n?parseFloat(n.xrp):0;if(k)return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-white",children:"Initiation Submitted"}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500/10 to-blue-600/10 border border-blue-500/20 rounded-xl p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-blue-400 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-400",children:"Processing Your Initiation"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-300",children:"Your initiation has been submitted to the blockchain. It may take a minute or two to be confirmed."}),(0,a.jsx)("div",{className:"bg-slate-900/50 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-gray-400",children:"The page will automatically update once your initiation is confirmed. Please be patient."})}),(0,a.jsxs)("div",{className:"border-t border-blue-500/20 pt-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-400 mb-3",children:"What's happening now:"}),(0,a.jsxs)("ol",{className:"space-y-3 text-gray-300",children:[(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"1"}),(0,a.jsx)("span",{children:"Your initiation rite is being recorded on the XRP Ledger"})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"2"}),(0,a.jsx)("span",{children:"A secure connection is being established with the PostFiat node"})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"3"}),(0,a.jsx)("span",{children:"Your Google Doc link is being securely stored"})]})]})]})]})]})]});if(e<=0)return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-white",children:"Step 1: Fund Your Wallet"}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500/10 to-blue-600/10 border border-blue-500/20 rounded-xl p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-blue-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-400",children:"Wallet Funding Required"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-300",children:"Before you can complete the initiation process, you need at least 2 XRP in your wallet."}),(0,a.jsxs)("div",{className:"bg-slate-900/50 rounded-lg p-4",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Current balance:"}),(0,a.jsxs)("span",{className:"ml-2 text-xl font-medium text-white",children:[(null==n?void 0:n.xrp)||"0"," XRP"]})]}),(0,a.jsxs)("div",{className:"border-t border-blue-500/20 pt-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-400 mb-3",children:"To fund your wallet:"}),(0,a.jsxs)("ol",{className:"space-y-3 text-gray-300",children:[(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"1"}),(0,a.jsx)("span",{children:"Send XRP from another wallet or exchange"})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"2"}),(0,a.jsx)("span",{children:"Use your wallet address shown above"})]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center rounded-full bg-blue-500/20 text-blue-400 text-sm",children:"3"}),(0,a.jsx)("span",{children:"Wait for the transaction to confirm"})]})]})]})]})]})]});switch(s){case"UNSTARTED":return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-white",children:"Step 2: Complete Initiation"}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500/10 to-blue-600/10 border border-blue-500/20 rounded-xl p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-blue-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-400",children:"Complete Your Initiation"})]}),(0,a.jsxs)("form",{onSubmit:E,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"initiation-rite",className:"block text-sm font-medium text-gray-300 mb-2",children:"Initiation Rite"}),(0,a.jsx)("textarea",{id:"initiation-rite",value:g,onChange:e=>b(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,placeholder:"Write your initiation rite here...",required:!0}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-400",children:"Your initiation rite should be a thoughtful statement about your intentions and goals."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"google-doc",className:"block text-sm font-medium text-gray-300 mb-2",children:"Google Doc Link"}),(0,a.jsx)("input",{type:"url",id:"google-doc",value:f,onChange:e=>j(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://docs.google.com/...",required:!0}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-400",children:"Share a Google Doc that contains your detailed background and interests."})]}),N&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:N}),(0,a.jsx)("div",{className:"pt-4 border-t border-slate-800",children:(0,a.jsxs)("button",{type:"submit",disabled:y,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)("span",{children:y?"Submitting...":"Submit Initiation"}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]})}),(0,a.jsxs)("div",{className:"bg-blue-900/20 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-blue-400 mb-2",children:"What happens next?"}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-gray-300",children:[(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"h-4 w-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Create a trust line for the PFT token"]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"h-4 w-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Submit your initiation rite transaction"]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"h-4 w-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Send handshake transactions to the node and remembrancer"]}),(0,a.jsxs)("li",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"h-4 w-4 text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Submit your Google Doc context link"]})]})]})]})]}),m&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-lg w-full max-w-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Confirm Initiation"}),(0,a.jsx)("p",{className:"text-gray-300 mb-4",children:"Are you sure you want to submit your initiation? This will:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-gray-300 mb-6 space-y-2",children:[(0,a.jsx)("li",{children:"Create a trust line for the PFT token"}),(0,a.jsx)("li",{children:"Submit your initiation rite"}),(0,a.jsx)("li",{children:"Set up secure communication with the network"}),(0,a.jsx)("li",{children:"Submit your context document"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>u(!1),className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{u(!1),p(!0)},className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors text-sm font-medium",children:"Confirm"})]})]})}),(0,a.jsx)(x,{isOpen:h,onClose:()=>p(!1),onConfirm:P,error:N})]});case"INITIATED":case"COMPLETE":return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Initiation Complete"}),(0,a.jsx)("p",{children:"Your account has been successfully initiated. You can now use the network."})]});case"PENDING":return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Initiation Pending"}),(0,a.jsx)("p",{children:"Your initiation request is being processed. Please check back soon."})]});case"REJECTED":return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Initiation Rejected"}),(0,a.jsx)("p",{children:"Your initiation request was not accepted. Please contact support for more information."})]});default:return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Account Setup Required"}),(0,a.jsx)("p",{children:"Additional setup is needed for your account."}),(0,a.jsxs)("p",{className:"text-sm text-gray-400 mt-2",children:["Status: ",s]})]})}})()]})})]})},_=e=>{let{isOpen:s,onClose:t,onDecrypt:r,error:n}=e,[i,o]=(0,l.useState)("");return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg max-w-md w-full p-6 shadow-xl",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-white",children:"Decrypt Messages"}),(0,a.jsx)("p",{className:"text-slate-300 mb-4",children:"Your messages are encrypted. Please enter your password to decrypt and view them."}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r(i)},children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-slate-300 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",id:"password",value:i,onChange:e=>o(e.target.value),className:"w-full bg-slate-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your password",autoFocus:!0})]}),n&&(0,a.jsx)("div",{className:"mb-4 p-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:(0,a.jsx)("p",{className:"text-red-400 text-sm",children:n})}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-slate-500",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:!i,children:"Decrypt"})]})]})]})}):null},E=e=>{let{address:s}=e;(0,l.useContext)(d);let t="rJ1mBMhEBKack5uTQvM8vWoAntbufyG9Yn",[r,n]=(0,l.useState)("odv"),[i,o]=(0,l.useState)(!1),[c,m]=(0,l.useState)(!1),[u,h]=(0,l.useState)(null),[p,g]=(0,l.useState)(!1),[b,f]=(0,l.useState)(),[j,y]=(0,l.useState)(!1),[v,N]=(0,l.useState)(),[w,k]=(0,l.useState)(null),[S,C]=(0,l.useState)(!1),[E,P]=(0,l.useState)(null),[T,F]=(0,l.useState)([{address:t,displayName:"ODV",lastMessage:"Greetings. I am ODV, a mediator between you and Future AI. I'm here to help translate strategic insights focused on life extension and wealth creation. How may I assist you today?",timestamp:Date.now(),unread:0}]),[I,A]=(0,l.useState)("ODV"),[D,O]=(0,l.useState)(!1),[R,M]=(0,l.useState)(null),[L,q]=(0,l.useState)(""),[z,W]=(0,l.useState)([{id:"1",from:"ODV",to:s,content:"Greetings. I am ODV, a mediator between you and Future AI. I'm here to help translate strategic insights focused on life extension and wealth creation. How may I assist you today?",timestamp:Date.now()-1e3}]),[V,B]=(0,l.useState)(""),H=async e=>{if(s){m(!0);try{let[a]=await Promise.all([fetch("http://localhost:8000/api/odv/messages/".concat(s),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e||E})}),new Promise(e=>setTimeout(e,1e3))]);if(!a.ok){let e=await a.text();throw Error("Failed to fetch messages: ".concat(e))}let l=await a.json();if("success"===l.status){let s=l.messages.map(e=>({id:e.id,from:e.from,to:e.to,content:e.content,timestamp:e.timestamp}));if(W(s),s.length>0){let e=s[s.length-1];F(s=>s.map(s=>s.address===t?{...s,lastMessage:e.content,timestamp:e.timestamp,unread:0}:s))}e&&(P(e),C(!0))}}catch(e){console.error("Error fetching messages:",e),h(e instanceof Error?e.message:"An error occurred"),"decryptMessages"===w&&N(e instanceof Error?e.message:"Failed to decrypt messages")}finally{o(!1),m(!1)}}},U=async e=>{"sendMessage"===w?await J(e):"sendLog"===w?await G(e):"decryptMessages"===w&&await H(e),y(!1),k(null)},J=async e=>{if(!V.trim()||!s){h("Please enter a message");return}o(!0);try{let a=await fetch("http://localhost:8000/api/odv/send_message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:s,password:e,message:V.trim(),amount_pft:0})});if(!a.ok){let e=await a.text();throw Error("Failed to send message: ".concat(e))}let l=await a.json();if("success"===l.status){let e={id:l.message_id,from:s,to:t,content:V.trim(),timestamp:Date.now()};W(s=>[...s,e]),B(""),F(e=>e.map(e=>e.address===t?{...e,lastMessage:V.trim(),timestamp:Date.now(),unread:0}:e)),setTimeout(()=>{H()},5e3)}}catch(e){console.error("Error sending message:",e),h(e instanceof Error?e.message:"An error occurred"),N(e instanceof Error?e.message:"Failed to send message")}finally{o(!1)}},G=async e=>{if(!V.trim()||!s){h("Please enter a log message");return}o(!0);try{let a=await fetch("http://localhost:8000/api/odv/send_log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:s,password:e,log_content:V.trim(),amount_pft:0})});if(!a.ok){let e=await a.text();throw Error("Failed to send log entry: ".concat(e))}let l=await a.json();if("success"===l.status){let e={id:l.log_id,from:s,to:t,content:V.trim(),timestamp:Date.now()};W(s=>[...s,e]),B(""),F(e=>e.map(e=>e.address===t?{...e,lastMessage:"Log: ".concat(V.trim()),timestamp:Date.now(),unread:0}:e))}}catch(e){console.error("Error sending log entry:",e),h(e instanceof Error?e.message:"An error occurred"),N(e instanceof Error?e.message:"Failed to send log entry")}finally{o(!1)}},X=()=>{if(!V.trim()){h("Please enter a message");return}k("sendMessage"),N(void 0),y(!0)},Y=()=>{if(!V.trim()){h("Please enter a log message");return}k("sendLog"),N(void 0),y(!0)},K=()=>{"odv"===r?X():"logging"===r&&Y()},$=async e=>{try{await H(e),g(!1)}catch(e){console.error("Error decrypting messages:",e),f(e instanceof Error?e.message:"Failed to decrypt messages")}};(0,l.useEffect)(()=>{s&&(S?E&&H():(f(void 0),g(!0)))},[s]),(0,l.useEffect)(()=>{if(!s||!S)return;let e=setInterval(()=>{H()},3e4);return()=>clearInterval(e)},[s,S]);let Z=(e,s)=>{s.stopPropagation(),M(e),q(e.displayName),O(!0)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex h-[calc(100vh-120px)] overflow-hidden",children:[(0,a.jsxs)("div",{className:"w-1/4 min-w-[250px] border-r border-slate-700 flex flex-col",children:[(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:T.map(e=>(0,a.jsxs)("div",{onClick:()=>A(e.address),className:"p-4 cursor-pointer hover:bg-slate-800 relative ".concat(I===e.address?"bg-slate-800":""),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"font-medium text-slate-200",children:e.displayName}),(0,a.jsx)("button",{onClick:s=>Z(e,s),className:"text-slate-400 hover:text-slate-200 p-1 opacity-60 hover:opacity-100 transition-opacity",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 01.67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 11-.671-1.34l.041-.022zM12 9a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})})})]}),(0,a.jsx)("div",{className:"text-sm text-slate-400 truncate",children:e.lastMessage})]},e.address))}),(0,a.jsx)("div",{className:"border-t border-slate-700 p-4 sticky bottom-0 bg-slate-900",children:(0,a.jsxs)("div",{className:"flex rounded-lg overflow-hidden",children:[(0,a.jsx)("button",{onClick:()=>n("odv"),className:"flex-1 py-2 px-3 flex justify-center items-center transition-colors ".concat("odv"===r?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:"ODV Chat"}),(0,a.jsx)("button",{onClick:()=>n("logging"),className:"flex-1 py-2 px-3 flex justify-center items-center transition-colors ".concat("logging"===r?"bg-blue-600 text-white":"bg-slate-700 text-slate-300 hover:bg-slate-600"),children:"Logging"})]})})]}),(0,a.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:I?(0,a.jsxs)(a.Fragment,{children:[u&&(0,a.jsxs)("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4 m-4",children:[(0,a.jsx)("p",{className:"text-red-400 text-sm",children:u}),(0,a.jsx)("button",{className:"text-xs text-red-400 hover:text-red-300 mt-2",onClick:()=>h(null),children:"Dismiss"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[S||i?z.map(e=>(0,a.jsx)("div",{className:"max-w-[70%] p-3 rounded-lg break-words overflow-hidden ".concat(e.from===s?"ml-auto bg-blue-600 text-white":"bg-slate-700 text-slate-200"),children:(0,a.jsx)("div",{className:"whitespace-pre-wrap break-all overflow-hidden",children:e.content})},e.id)):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[(0,a.jsx)("p",{children:"Messages need to be decrypted"}),(0,a.jsx)("button",{onClick:()=>{f(void 0),g(!0)},className:"mt-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Decrypt Messages"})]}),c&&(0,a.jsx)("div",{className:"flex justify-center items-center p-2",children:(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 text-slate-400",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]}),(0,a.jsx)("div",{className:"p-4 border-t border-slate-700 sticky bottom-0 bg-slate-900",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:V,onChange:e=>B(e.target.value),onKeyPress:e=>"Enter"===e.key&&K(),placeholder:"odv"===r?"Type a message...":"Type a log entry...",className:"flex-1 bg-slate-800 text-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:i||!S}),(0,a.jsx)("button",{onClick:K,className:"bg-blue-600 text-white px-4 py-2 rounded-lg ".concat(i||!S?"opacity-50 cursor-not-allowed":"hover:bg-blue-700"),disabled:i||!S,children:i?"Sending...":"odv"===r?"Send":"Log"})]})})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center text-slate-400",children:"Select a conversation to start messaging"})})]}),D&&R&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-6 max-w-md w-full",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-slate-200 mb-4",children:"Thread Information"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Address"}),(0,a.jsx)("div",{className:"text-slate-200 bg-slate-700 p-2 rounded break-all",children:R.address})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Nickname"}),(0,a.jsx)("input",{type:"text",value:L,onChange:e=>q(e.target.value),className:"w-full bg-slate-700 text-slate-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>O(!1),className:"px-4 py-2 text-slate-400 hover:text-slate-200",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{R&&L.trim()&&(F(T.map(e=>e.address===R.address?{...e,displayName:L.trim()}:e)),O(!1))},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Save"})]})]})}),(0,a.jsx)(x,{isOpen:j,onClose:()=>{y(!1),k(null)},onConfirm:U,error:v}),(0,a.jsx)(_,{isOpen:p,onClose:()=>{g(!1),S||h("Messages are encrypted. Please decrypt to view them.")},onDecrypt:$,error:b})]})},P=()=>{let{address:e,username:s}=(0,l.useContext)(d),[t,r]=(0,l.useState)(""),[n,i]=(0,l.useState)(null),[o,c]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null),[u,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(!1),b=async s=>{s.preventDefault(),c(!0),x(null);try{let s=await fetch("http://localhost:8000/api/wallet/seed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account:e,password:t})});if(!s.ok){let e=await s.json();throw Error(e.detail||"Failed to retrieve seed")}let a=await s.json();i(a.seed),h(!0),r("")}catch(e){console.error("Error retrieving seed:",e),x(e instanceof Error?e.message:"Failed to retrieve seed")}finally{c(!1)}};return(0,a.jsxs)("div",{className:"bg-slate-900 rounded-lg p-6 text-white",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Account Settings"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Account Information"}),(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 mb-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Username"}),(0,a.jsx)("p",{className:"font-medium",children:s})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Wallet Address"}),(0,a.jsx)("p",{className:"font-mono text-sm break-all",children:e})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Backup & Security"}),u?(0,a.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h3",{className:"font-medium",children:"Your Seed Phrase"}),(0,a.jsx)("button",{onClick:()=>h(!1),className:"text-sm text-gray-400 hover:text-white",children:"Hide"})]}),(0,a.jsx)("div",{className:"bg-slate-900 border border-yellow-500/30 rounded-md p-3 mb-4",children:(0,a.jsx)("p",{className:"font-mono break-all text-yellow-400",children:n})}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Store this somewhere safe and secure"}),(0,a.jsx)("button",{onClick:()=>{n&&(navigator.clipboard.writeText(n),g(!0),setTimeout(()=>g(!1),2e3))},className:"bg-slate-700 hover:bg-slate-600 text-white text-sm py-1 px-3 rounded-md flex items-center",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Copied"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,a.jsx)("path",{d:"M8 2a1 1 0 000 2h2a1 1 0 100-2H8z"}),(0,a.jsx)("path",{d:"M3 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L10.414 13H15v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5zM15 11h2a1 1 0 110 2h-2v-2z"})]}),"Copy"]})})]})]}):(0,a.jsxs)("form",{onSubmit:b,className:"bg-slate-800 rounded-lg p-4",children:[(0,a.jsxs)("p",{className:"mb-4 text-yellow-400",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 inline-block mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Never share your seed phrase with anyone. It provides full access to your wallet."]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Enter your password to reveal your seed phrase"}),(0,a.jsx)("input",{type:"password",id:"password",value:t,onChange:e=>r(e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),m&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-800 rounded-md text-red-200 text-sm",children:m}),(0,a.jsx)("button",{type:"submit",disabled:o||!t,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white py-2 px-4 rounded-md transition duration-200",children:o?"Loading...":"Reveal Seed Phrase"})]})]})]})]})};function T(){let[e,s]=(0,l.useState)("summary"),[t,r]=(0,l.useState)({isAuthenticated:!1,address:null,username:null,password:null}),[n,i]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let e=localStorage.getItem("wallet_address"),s=localStorage.getItem("username");e&&s&&r({isAuthenticated:!0,address:e,username:s,password:null})},[]),(0,l.useEffect)(()=>{let e=async()=>{if(t.address)try{console.log("Checking init status for address:",t.address);let e=await fetch("http://localhost:8000/api/account/".concat(t.address,"/status?refresh=true&nocache=").concat(Date.now())),s=await e.json();console.log("Initiation status response:",s),i(s.init_rite_status||"UNSTARTED")}catch(e){console.error("Error checking initialization status:",e),i("UNSTARTED")}finally{d(!1)}};if(t.isAuthenticated){e();let s=setInterval(()=>{e()},1e4);return()=>clearInterval(s)}d(!1)},[t.isAuthenticated,t.address]);let x=async()=>{if(console.log("Signing out and resetting all state..."),t.address)try{await fetch("http://localhost:8000/api/tasks/clear-state/".concat(t.address),{method:"POST"}),console.log("Server state cleared for account:",t.address)}catch(e){console.error("Error clearing server state:",e)}r({isAuthenticated:!1,address:null,username:null,password:null}),i(null),s("summary"),localStorage.removeItem("wallet_address"),localStorage.removeItem("username"),setTimeout(()=>{console.log("Sign out complete, state reset")},100)};return t.isAuthenticated?o?(0,a.jsx)("div",{children:"Loading..."}):n&&["UNSTARTED","PENDING_INITIATION","PENDING"].includes(n)?(0,a.jsx)(c,{value:t,onClearAuth:x,children:(0,a.jsx)(C,{initStatus:n,address:t.address,onCheckStatus:e=>{i(e.init_rite_status)}})}):(0,a.jsx)(c,{value:t,onClearAuth:x,children:(0,a.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,a.jsx)(S,{username:t.username,onSignOut:x,activePage:e,onPageChange:e=>{s(e)}}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:(()=>{switch(e){case"proposals":return(0,a.jsx)(j,{});case"verification":return(0,a.jsx)(y,{});case"rewards":return(0,a.jsx)(v,{});case"payments":return(0,a.jsx)(w,{});case"memos":return(0,a.jsx)(E,{address:t.address});case"settings":return(0,a.jsx)(P,{});default:return(0,a.jsx)(m,{})}})()})]})}):(0,a.jsx)(k,{onAuth:(e,s,t)=>{r({isAuthenticated:!0,address:e,username:s,password:t}),localStorage.setItem("wallet_address",e),localStorage.setItem("username",s)}})}}},e=>{var s=s=>e(e.s=s);e.O(0,[441,517,358],()=>s(8148)),_N_E=e.O()}]);